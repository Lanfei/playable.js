{"version":3,"file":"playable.min.js","sources":["../src/event/Event.ts","../src/event/EventEmitter.ts","../src/system/Ticker.ts","../src/geom/Vector.ts","../src/geom/Matrix.ts","../src/geom/Rectangle.ts","../src/event/TouchEvent.ts","../src/display/Layer.ts","../src/tween/Ease.ts","../src/tween/Tween.ts","../src/display/Scroller.ts","../src/display/Image.ts","../src/display/Text.ts","../src/display/Input.ts","../src/display/MovieClip.ts","../src/net/Request.ts","../src/media/Media.ts","../src/media/Sound.ts","../src/media/Texture.ts","../src/net/ResourceManager.ts","../src/display/Stage.ts","../src/index.ts"],"sourcesContent":["import {EventEmitter} from './EventEmitter';\n\nexport class Event {\n\n\t/** @event added */\n\tpublic static readonly ADDED: string = 'added';\n\t/** @event removed */\n\tpublic static readonly REMOVED: string = 'removed';\n\t/** @event addedToStage */\n\tpublic static readonly ADDED_TO_STAGE: string = 'addedToStage';\n\t/** @event removeFromStage */\n\tpublic static readonly REMOVED_FROM_STAGE: string = 'removeFromStage';\n\t/** @event activate */\n\tpublic static readonly ACTIVATE: string = 'activate';\n\t/** @event deactivate */\n\tpublic static readonly DEACTIVATE: string = 'deactivate';\n\t/** @event enterFrame */\n\tpublic static readonly ENTER_FRAME: string = 'enterFrame';\n\t/** @event tick */\n\tpublic static readonly TICK: string = 'tick';\n\t/** @event tickerPause */\n\tpublic static readonly TICKER_PAUSE: string = 'tickerPause';\n\t/** @event tickerResume */\n\tpublic static readonly TICKER_RESUME: string = 'tickerResume';\n\t/** @event viewportResize */\n\tpublic static readonly VIEWPORT_RESIZE: string = 'viewportResize';\n\t/** @event load */\n\tpublic static readonly LOAD: string = 'load';\n\t/** @event abort */\n\tpublic static readonly ABORT: string = 'abort';\n\t/** @event error */\n\tpublic static readonly ERROR: string = 'error';\n\t/** @event progress */\n\tpublic static readonly PROGRESS: string = 'progress';\n\t/** @event complete */\n\tpublic static readonly COMPLETE: string = 'complete';\n\t/** @event ended */\n\tpublic static readonly ENDED: string = 'ended';\n\t/** @event soundComplete */\n\tpublic static readonly SOUND_COMPLETE: string = 'soundComplete';\n\n\tpublic type: string = null;\n\tpublic data: any = null;\n\tpublic target: EventEmitter = null;\n\tpublic currentTarget: EventEmitter = null;\n\n\tprotected constructor(type: string, data: any = null) {\n\t\tthis.$init(type, data);\n\t}\n\n\tprotected $init(type: string, data: any = null): this {\n\t\tthis.type = type;\n\t\tthis.data = data;\n\t\treturn this;\n\t}\n\n\tpublic release(): void {\n\t\tthis.type = null;\n\t\tthis.data = null;\n\t\tEvent.recycle(this);\n\t}\n\n\tprotected static readonly $pool: Array<Event> = [];\n\n\tpublic static create(type: string, data: any = null): Event {\n\t\tlet pool = this.$pool;\n\t\tif (pool.length > 0) {\n\t\t\treturn pool.pop().$init(type, data);\n\t\t} else {\n\t\t\treturn new Event(type, data);\n\t\t}\n\t}\n\n\tpublic static recycle(e: Event) {\n\t\tthis.$pool.push(e);\n\t}\n\n}","import {Event} from './Event';\n\nexport class EventEmitter {\n\n\tprotected $events: Object = {};\n\tprotected $emittingType: string = null;\n\tprotected $removedListeners: Listener[] = [];\n\n\tpublic on(type: string, listener: Listener): this {\n\t\tlet listeners: Listener[] = this.$events[type] || [];\n\t\tlisteners.push(listener);\n\t\tthis.$events[type] = listeners;\n\t\treturn this;\n\t}\n\n\tpublic off(type: string, listener?: Listener): this {\n\t\tif (this.$emittingType === type && listener) {\n\t\t\tthis.$removedListeners.push(listener);\n\t\t} else {\n\t\t\tlet listeners: Listener[] = this.$events[type] || [];\n\t\t\tif (listener) {\n\t\t\t\tlet index = listeners.indexOf(listener);\n\t\t\t\tif (index >= 0) {\n\t\t\t\t\tlisteners.splice(index, 1);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlisteners.length = 0;\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tpublic once(type: string, listener: Listener): this {\n\t\tlet that = this;\n\t\tlet wrapper = function () {\n\t\t\tlistener.apply(this, arguments);\n\t\t\tthat.off(type, wrapper);\n\t\t};\n\t\treturn this.on(type, wrapper);\n\t}\n\n\tpublic emit(event: Event): boolean;\n\tpublic emit(type: string, ...args: any[]): boolean;\n\tpublic emit(type: string | Event, ...args: any[]): boolean {\n\t\tlet event;\n\t\tif (type instanceof Event) {\n\t\t\targs = [type];\n\t\t\ttype.target = type.target || this;\n\t\t\ttype.currentTarget = this;\n\t\t\ttype = type.type;\n\t\t}\n\t\tlet listeners: Listener[] = this.$events[type];\n\t\tlet hasListeners = listeners && listeners.length > 0;\n\t\tlet removedListeners = this.$removedListeners;\n\t\tif (!event && hasListeners && args.length === 0) {\n\t\t\tevent = Event.create(type);\n\t\t\tevent.target = this;\n\t\t\tevent.currentTarget = this;\n\t\t\targs.push(event);\n\t\t}\n\t\tif (hasListeners) {\n\t\t\tthis.$emittingType = type;\n\t\t\tfor (let listener of listeners) {\n\t\t\t\tif (removedListeners.indexOf(listener) < 0) {\n\t\t\t\t\tlistener.apply(this, args);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.$emittingType = null;\n\t\t}\n\t\tif (event) {\n\t\t\tevent.release();\n\t\t}\n\t\tfor (let listener of removedListeners) {\n\t\t\tthis.off(<string>type, listener);\n\t\t}\n\t\tremovedListeners.length = 0;\n\t\treturn hasListeners;\n\t}\n\n\tpublic hasEventListener(type: string): boolean {\n\t\tlet listeners: Listener[] = this.$events[type];\n\t\treturn !!listeners && listeners.length > 0;\n\t}\n\n\tpublic removeAllListeners(): this {\n\t\tthis.$events = {};\n\t\treturn this;\n\t}\n\n}\n\nexport type Listener = (...args: any[]) => any;\n","import {Layer} from '../display/Layer';\nimport {Stage} from '../display/Stage';\nimport {Event} from '../event/Event';\nimport {EventEmitter} from '../event/EventEmitter';\n\nexport class Ticker extends EventEmitter {\n\n\tprotected $stage: Stage = null;\n\tprotected $fps: number = 0;\n\tprotected $deltaTime: number = 0;\n\tprotected $paused: boolean = true;\n\tprotected $shouldResume: boolean = false;\n\tprotected $timerIndex: number = 0;\n\tprotected $lastTimestamp: number = 0;\n\tprotected $tickHandle: number = null;\n\tprotected readonly $timers: Object;\n\tprotected readonly $boundTick: () => void;\n\tprotected readonly $enterFrameCallbackList: Array<Layer>;\n\n\tpublic constructor(stage: Stage) {\n\t\tsuper();\n\t\tthis.$stage = stage;\n\t\tthis.$timers = [];\n\t\tthis.$boundTick = this.$tick.bind(this);\n\t\tthis.$enterFrameCallbackList = [stage];\n\t\tthis.$start();\n\t}\n\n\tpublic get fps(): number {\n\t\treturn this.$fps;\n\t}\n\n\tpublic get deltaTime(): number {\n\t\treturn this.$deltaTime;\n\t}\n\n\tpublic get paused(): boolean {\n\t\treturn this.$paused;\n\t}\n\n\tprotected $start(): this {\n\t\tlet stage = this.$stage;\n\t\tlet prefixes = ['', 'o', 'ms', 'moz', 'webkit'];\n\n\t\tfor (let prefix of prefixes) {\n\t\t\tlet requestKey = prefix ? prefix + 'RequestAnimationFrame' : 'requestAnimationFrame';\n\t\t\tlet cancelKey = prefix ? prefix + 'CancelAnimationFrame' : 'cancelAnimationFrame';\n\t\t\tlet cancelRequestKey = prefix ? prefix + 'CancelRequestAnimationFrame' : 'cancelRequestAnimationFrame';\n\t\t\twindow.requestAnimationFrame = window.requestAnimationFrame || window[requestKey];\n\t\t\twindow.cancelAnimationFrame = window.cancelAnimationFrame || window[cancelKey] || window[cancelRequestKey];\n\t\t}\n\t\tif (!window.requestAnimationFrame) {\n\t\t\twindow.requestAnimationFrame = function (callback) {\n\t\t\t\treturn window.setTimeout(callback, 1000 / 60);\n\t\t\t};\n\t\t\twindow.cancelAnimationFrame = function (handle) {\n\t\t\t\twindow.clearTimeout(handle);\n\t\t\t}\n\t\t}\n\n\t\tstage.on(Event.ACTIVATE, () => {\n\t\t\tif (this.$shouldResume) {\n\t\t\t\tthis.resume();\n\t\t\t\tthis.$shouldResume = false;\n\t\t\t}\n\t\t});\n\t\tstage.on(Event.DEACTIVATE, () => {\n\t\t\tif (!this.$paused) {\n\t\t\t\tthis.pause();\n\t\t\t\tthis.$shouldResume = true;\n\t\t\t}\n\t\t});\n\n\t\tif (stage.activated) {\n\t\t\tthis.$paused = false;\n\t\t\tthis.$tick();\n\t\t} else {\n\t\t\tthis.$shouldResume = true;\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tpublic pause(): this {\n\t\tif (!this.$paused) {\n\t\t\tthis.$paused = true;\n\t\t\tthis.$lastTimestamp = 0;\n\t\t\tthis.emit(Event.TICKER_PAUSE);\n\t\t\tcancelAnimationFrame(this.$tickHandle);\n\t\t}\n\t\treturn this;\n\t}\n\n\tpublic resume(): this {\n\t\tif (this.$paused) {\n\t\t\tthis.$paused = false;\n\t\t\tthis.$tick();\n\t\t\tthis.emit(Event.TICKER_RESUME);\n\t\t}\n\t\treturn this;\n\t}\n\n\tpublic setTimeout(handler: Function, timeout: number = 0): number {\n\t\tlet handle = ++this.$timerIndex;\n\t\tthis.$timers[handle] = {handler, timeout, resetTime: timeout};\n\t\treturn handle;\n\t}\n\n\tpublic clearTimeout(handle: number): void {\n\t\tdelete this.$timers[handle];\n\t}\n\n\tpublic setInterval(handler: Function, timeout: number): number {\n\t\tlet handle = ++this.$timerIndex;\n\t\tthis.$timers[handle] = {handler, timeout, resetTime: timeout, interval: true};\n\t\treturn handle;\n\t}\n\n\tpublic clearInterval(handle: number): void {\n\t\tdelete this.$timers[handle];\n\t}\n\n\tpublic registerEnterFrameCallback(layer: Layer): this {\n\t\tlet list = this.$enterFrameCallbackList;\n\t\tif (list.indexOf(layer) < 0) {\n\t\t\tlist.push(layer);\n\t\t}\n\t\treturn this;\n\t}\n\n\tpublic unregisterEnterFrameCallback(layer: Layer): this {\n\t\tlet list = this.$enterFrameCallbackList;\n\t\tlet index = list.indexOf(layer);\n\t\tif (index >= 0) {\n\t\t\tlist.splice(index, 1);\n\t\t}\n\t\treturn this;\n\t}\n\n\tprotected $tick(): void {\n\t\tlet now = Date.now();\n\t\tlet lastTimestamp = this.$lastTimestamp;\n\t\tlet deltaTime = lastTimestamp ? now - this.$lastTimestamp : 1000 / 60;\n\t\tlet enterFrameCallbackList = this.$enterFrameCallbackList;\n\t\tthis.$fps = Math.round(1000 / deltaTime);\n\t\tthis.$deltaTime = deltaTime;\n\t\tthis.$lastTimestamp = now;\n\t\tthis.$tickHandle = window.requestAnimationFrame(this.$boundTick);\n\t\tthis.$checkTimers(deltaTime);\n\t\tlet event = Event.create(Event.ENTER_FRAME, deltaTime);\n\t\tfor (let layer of enterFrameCallbackList) {\n\t\t\tlayer.emit(event);\n\t\t}\n\t\tevent.release();\n\t\tlet tickEvent = Event.create(Event.TICK, deltaTime);\n\t\tthis.emit(tickEvent);\n\t\ttickEvent.release();\n\t}\n\n\tprotected $checkTimers(dt: number): void {\n\t\tlet timers = this.$timers;\n\t\tfor (let key in timers) {\n\t\t\tlet timer = timers[key];\n\t\t\tlet restTime = timer.resetTime = timer.resetTime - dt;\n\t\t\tif (restTime <= 0) {\n\t\t\t\ttimer.handler();\n\t\t\t\tif (timer.interval) {\n\t\t\t\t\ttimer.resetTime += timer.timeout;\n\t\t\t\t} else {\n\t\t\t\t\tthis.clearTimeout(+key);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n}","import {Matrix} from './Matrix';\n\nexport class Vector {\n\n\tpublic x: number;\n\tpublic y: number;\n\n\tprotected constructor(x?: number, y?: number) {\n\t\tthis.set(x, y);\n\t}\n\n\tpublic get length(): number {\n\t\treturn Math.sqrt(this.x * this.x + this.y * this.y);\n\t}\n\n\tpublic get angle(): number {\n\t\treturn Math.atan2(this.y, this.x);\n\t}\n\n\tpublic set(x: number, y: number): this {\n\t\tthis.x = x || 0;\n\t\tthis.y = y || 0;\n\t\treturn this;\n\t}\n\n\tpublic add(v: Vector): this;\n\tpublic add(x: number, y: number): this;\n\tpublic add(x: number | Vector, y?: number): this {\n\t\tif (x instanceof Vector) {\n\t\t\tthis.x += x.x;\n\t\t\tthis.y += x.y;\n\t\t} else {\n\t\t\tthis.x += x;\n\t\t\tthis.y += y;\n\t\t}\n\t\treturn this;\n\t}\n\n\tpublic subtract(v: Vector): this;\n\tpublic subtract(x: number, y: number): this;\n\tpublic subtract(x: number | Vector, y?: number): this {\n\t\tif (x instanceof Vector) {\n\t\t\tthis.x -= x.x;\n\t\t\tthis.y -= x.y;\n\t\t} else {\n\t\t\tthis.x -= x;\n\t\t\tthis.y -= y;\n\t\t}\n\t\treturn this;\n\t}\n\n\tpublic dotProduct(v: Vector): number;\n\tpublic dotProduct(x: number, y: number): number;\n\tpublic dotProduct(x: number | Vector, y?: number): number {\n\t\tif (x instanceof Vector) {\n\t\t\treturn this.x * x.x + this.y * x.y;\n\t\t} else {\n\t\t\treturn this.x * x + this.y * y;\n\t\t}\n\t}\n\n\tpublic normalize(): this {\n\t\tlet length = this.length;\n\t\tthis.x = this.x / length;\n\t\tthis.y = this.y / length;\n\t\treturn this;\n\t}\n\n\tpublic negate(): this {\n\t\tthis.x *= -1;\n\t\tthis.y *= -1;\n\t\treturn this;\n\t}\n\n\tpublic scale(x: number, y?: number): this {\n\t\tthis.x *= x;\n\t\tthis.y *= y === undefined ? x : y;\n\t\treturn this;\n\t}\n\n\tpublic rotate(angle: number): this {\n\t\tlet x = this.x;\n\t\tlet y = this.y;\n\t\tthis.x = x * Math.cos(angle) - y * Math.sin(angle);\n\t\tthis.y = x * Math.sin(angle) + y * Math.cos(angle);\n\t\treturn this;\n\t}\n\n\tpublic transform(m: Matrix): Vector {\n\t\tlet x = this.x;\n\t\tlet y = this.y;\n\t\tthis.x = m.a * x + m.c * y + m.tx;\n\t\tthis.y = m.b * x + m.d * y + m.ty;\n\t\treturn this;\n\t}\n\n\tpublic distance(v: Vector): number {\n\t\treturn Math.sqrt((this.x - v.x) * (this.x - v.x) + (this.y - v.y) * (this.y - v.y));\n\t}\n\n\tpublic equal(v: Vector): boolean {\n\t\treturn this.x === v.x && this.y === v.y;\n\t}\n\n\tpublic release(): this {\n\t\tVector.recycle(this);\n\t\treturn this;\n\t}\n\n\tprotected static readonly $pool: Array<Vector> = [];\n\n\tpublic static create(x?: number, y?: number): Vector {\n\t\tlet pool = this.$pool;\n\t\tif (pool.length > 0) {\n\t\t\treturn pool.pop().set(x, y);\n\t\t} else {\n\t\t\treturn new Vector(x, y);\n\t\t}\n\t}\n\n\tpublic static recycle(v: Vector) {\n\t\tthis.$pool.push(v);\n\t}\n}","import {Vector} from './Vector';\n\n/**\n * ```\n *             {a  b  0}\n * (x, y, 1) * {c  d  0} = (ax + cy + tx, bx + dy + ty, 1)\n *             {tx ty 1}\n * ```\n */\nexport class Matrix {\n\n\tpublic a: number;\n\tpublic b: number;\n\tpublic c: number;\n\tpublic d: number;\n\tpublic tx: number;\n\tpublic ty: number;\n\n\tprotected constructor(a?: number, b?: number, c?: number, d?: number, tx?: number, ty?: number) {\n\t\tif (arguments.length > 0) {\n\t\t\tthis.set(a, b, c, d, tx, ty);\n\t\t} else {\n\t\t\tthis.identity();\n\t\t}\n\t}\n\n\tpublic set(a: number, b: number, c: number, d: number, tx: number, ty: number): this {\n\t\tthis.a = a;\n\t\tthis.b = b;\n\t\tthis.c = c;\n\t\tthis.d = d;\n\t\tthis.tx = tx;\n\t\tthis.ty = ty;\n\t\treturn this;\n\t}\n\n\tpublic identity(): this {\n\t\treturn this.set(1, 0, 0, 1, 0, 0);\n\t}\n\n\tpublic invert(): this {\n\t\tlet a = this.a;\n\t\tlet b = this.b;\n\t\tlet c = this.c;\n\t\tlet d = this.d;\n\t\tlet tx = this.tx;\n\t\tlet ty = this.ty;\n\t\tlet n = a * d - c * b;\n\t\tthis.a = d / n;\n\t\tthis.b = -b / n;\n\t\tthis.c = -c / n;\n\t\tthis.d = a / n;\n\t\tthis.tx = (c * ty - d * tx) / n;\n\t\tthis.ty = (b * tx - a * ty) / n;\n\t\treturn this;\n\t}\n\n\tpublic prepend(m: Matrix): this;\n\tpublic prepend(a: number, b: number, c: number, d: number, tx: number, ty: number): this;\n\tpublic prepend(a: number | Matrix, b?: number, c?: number, d?: number, tx?: number, ty?: number): this {\n\t\tif (a instanceof Matrix) {\n\t\t\treturn this.prepend(a.a, a.b, a.c, a.d, a.tx, a.ty);\n\t\t}\n\t\tlet a1 = this.a;\n\t\tlet b1 = this.b;\n\t\tlet c1 = this.c;\n\t\tlet d1 = this.d;\n\t\tlet tx1 = this.tx;\n\t\tlet ty1 = this.ty;\n\t\tthis.a = a * a1 + b * c1;\n\t\tthis.b = a * b1 + b * d1;\n\t\tthis.c = c * a1 + d * c1;\n\t\tthis.d = c * b1 + d * d1;\n\t\tthis.tx = tx * a1 + ty * c1 + tx1;\n\t\tthis.ty = tx * b1 + ty * d1 + ty1;\n\t\treturn this;\n\t}\n\n\tpublic append(m: Matrix): this;\n\tpublic append(a: number, b: number, c: number, d: number, tx: number, ty: number): this;\n\tpublic append(a: number | Matrix, b?: number, c?: number, d?: number, tx?: number, ty?: number): this {\n\t\tif (a instanceof Matrix) {\n\t\t\treturn this.append(a.a, a.b, a.c, a.d, a.tx, a.ty);\n\t\t}\n\t\tlet a1 = this.a;\n\t\tlet b1 = this.b;\n\t\tlet c1 = this.c;\n\t\tlet d1 = this.d;\n\t\tlet tx1 = this.tx;\n\t\tlet ty1 = this.ty;\n\t\tthis.a = a * a1 + c * b1;\n\t\tthis.b = b * a1 + d * b1;\n\t\tthis.c = a * c1 + c * d1;\n\t\tthis.d = b * c1 + d * d1;\n\t\tthis.tx = a * tx1 + c * ty1 + tx;\n\t\tthis.ty = b * tx1 + d * ty1 + ty;\n\t\treturn this;\n\t}\n\n\tpublic scale(x: number, y?: number): this {\n\t\treturn this.append(x, 0, 0, y === undefined ? x : y, 0, 0);\n\t}\n\n\tpublic rotate(angle: number): this {\n\t\tlet sin = Math.sin(angle);\n\t\tlet cos = Math.cos(angle);\n\t\treturn this.append(cos, sin, -sin, cos, 0, 0);\n\t}\n\n\tpublic skew(skewX: number, skewY: number): this {\n\t\treturn this.append(1, Math.tan(skewY), Math.tan(skewX), 1, 0, 0);\n\t}\n\n\tpublic translate(v: Vector): this;\n\tpublic translate(x: number, y: number): this;\n\tpublic translate(x: number | Vector, y?: number): this {\n\t\tif (x instanceof Vector) {\n\t\t\treturn this.append(1, 0, 0, 1, x.x, x.y);\n\t\t}\n\t\treturn this.append(1, 0, 0, 1, x, y);\n\t}\n\n\tpublic equal(m: Matrix): boolean {\n\t\treturn m instanceof Matrix &&\n\t\t\tthis.a === m.a && this.b === m.b &&\n\t\t\tthis.c === m.c && this.d === m.d &&\n\t\t\tthis.tx === m.tx && this.ty === m.ty;\n\t}\n\n\tpublic release(): void {\n\t\tMatrix.recycle(this);\n\t}\n\n\tprotected static readonly $pool: Array<Matrix> = [];\n\n\tpublic static create(a?: number, b?: number, c?: number, d?: number, tx?: number, ty?: number): Matrix {\n\t\tlet m;\n\t\tlet pool = this.$pool;\n\t\tif (pool.length > 0) {\n\t\t\tm = pool.pop();\n\t\t} else {\n\t\t\tm = new Matrix();\n\t\t}\n\t\tif (arguments.length) {\n\t\t\tm.set(a, b, c, d, tx, ty);\n\t\t} else {\n\t\t\tm.identity();\n\t\t}\n\t\treturn m;\n\t}\n\n\tpublic static recycle(m: Matrix) {\n\t\tthis.$pool.push(m);\n\t}\n\n}","import {Vector} from './Vector';\n\nexport class Rectangle {\n\n\tpublic x: number;\n\tpublic y: number;\n\tpublic width: number;\n\tpublic height: number;\n\n\tprotected constructor(x?: number, y?: number, width?: number, height?: number) {\n\t\tthis.set(x, y, width, height);\n\t}\n\n\tpublic get top(): number {\n\t\treturn this.y;\n\t}\n\n\tpublic set top(top: number) {\n\t\tthis.height += this.y - top;\n\t\tthis.y = top;\n\t}\n\n\tpublic get bottom(): number {\n\t\treturn this.y + this.height;\n\t}\n\n\tpublic set bottom(bottom: number) {\n\t\tthis.height = bottom - this.y;\n\t}\n\n\tpublic get left(): number {\n\t\treturn this.x;\n\t}\n\n\tpublic set left(left: number) {\n\t\tthis.width += this.x - left;\n\t\tthis.x = left;\n\t}\n\n\tpublic get right(): number {\n\t\treturn this.x + this.width;\n\t}\n\n\tpublic set right(right: number) {\n\t\tthis.width = right - this.x;\n\t}\n\n\tpublic get topLeft(): Vector {\n\t\treturn Vector.create(this.left, this.top);\n\t}\n\n\tpublic set topLeft(v: Vector) {\n\t\tthis.top = v.y;\n\t\tthis.left = v.x;\n\t}\n\n\tpublic get bottomRight(): Vector {\n\t\treturn Vector.create(this.right, this.bottom);\n\t}\n\n\tpublic set bottomRight(v: Vector) {\n\t\tthis.bottom = v.y;\n\t\tthis.right = v.x;\n\t}\n\n\tpublic set(x: number, y: number, width: number, height: number): this {\n\t\tthis.x = x || 0;\n\t\tthis.y = y || 0;\n\t\tthis.width = width || 0;\n\t\tthis.height = height || 0;\n\t\treturn this;\n\t}\n\n\tpublic contains(v: Vector): boolean;\n\tpublic contains(x: number, y: number): boolean;\n\tpublic contains(x: number | Vector, y?: number): boolean {\n\t\tif (x instanceof Vector) {\n\t\t\treturn this.contains(x.x, x.y);\n\t\t}\n\t\treturn x >= this.x && x <= this.x + this.width && y >= this.y && y <= this.y + this.height;\n\t}\n\n\tpublic equal(r: Rectangle): boolean {\n\t\treturn r instanceof Rectangle &&\n\t\t\tr.x === this.x && r.y === this.y && r.width === this.width && r.height === this.height;\n\t}\n\n\tpublic release(): void {\n\t\tRectangle.recycle(this);\n\t}\n\n\tprotected static readonly $pool: Array<Rectangle> = [];\n\n\tpublic static create(x?: number, y?: number, width?: number, height?: number): Rectangle {\n\t\tlet pool = this.$pool;\n\t\tif (pool.length > 0) {\n\t\t\treturn pool.pop().set(x, y, width, height);\n\t\t} else {\n\t\t\treturn new Rectangle(x, y, width, height);\n\t\t}\n\t}\n\n\tpublic static recycle(r: Rectangle) {\n\t\tthis.$pool.push(r);\n\t}\n}","import {Event} from './Event';\nimport {Layer} from '../display/Layer';\n\nexport class TouchEvent extends Event {\n\n\t/** @event touchStart */\n\tpublic static readonly TOUCH_START: string = 'touchStart';\n\t/** @event touchMove */\n\tpublic static readonly TOUCH_MOVE: string = 'touchMove';\n\t/** @event touchEnd */\n\tpublic static readonly TOUCH_END: string = 'touchEnd';\n\t/** @event touchCancel */\n\tpublic static readonly TOUCH_CANCEL: string = 'touchCancel';\n\t/** @event touchTap */\n\tpublic static readonly TOUCH_TAP: string = 'touchTap';\n\n\tpublic target: Layer;\n\tpublic currentTarget: Layer;\n\tpublic targetX: number;\n\tpublic targetY: number;\n\tpublic localX: number;\n\tpublic localY: number;\n\tpublic stageX: number;\n\tpublic stageY: number;\n\tpublic identifier: number;\n\tpublic cancelBubble: boolean;\n\n\tprotected constructor(type: string) {\n\t\tsuper(type);\n\t\tthis.$init(type);\n\t}\n\n\tprotected $init(type: string): this {\n\t\tthis.type = type;\n\t\tthis.targetX = 0;\n\t\tthis.targetY = 0;\n\t\tthis.localX = 0;\n\t\tthis.localY = 0;\n\t\tthis.stageX = 0;\n\t\tthis.stageY = 0;\n\t\tthis.identifier = 0;\n\t\tthis.target = null;\n\t\tthis.currentTarget = null;\n\t\tthis.cancelBubble = false;\n\t\treturn this;\n\t}\n\n\tpublic stopPropagation() {\n\t\tthis.cancelBubble = true;\n\t}\n\n\tpublic release(): void {\n\t\tTouchEvent.recycle(this);\n\t}\n\n\tprotected static readonly $pool: Array<TouchEvent> = [];\n\n\tpublic static create(type: string): TouchEvent {\n\t\tlet pool = this.$pool;\n\t\tif (pool.length > 0) {\n\t\t\treturn pool.pop().$init(type);\n\t\t} else {\n\t\t\treturn new TouchEvent(type);\n\t\t}\n\t}\n\n\tpublic static recycle(e: TouchEvent) {\n\t\tthis.$pool.push(e);\n\t}\n\n}","import {Stage} from './Stage';\nimport {Ticker} from '../system/Ticker';\nimport {Matrix} from '../geom/Matrix';\nimport {Vector} from '../geom/Vector';\nimport {Rectangle} from '../geom/Rectangle';\nimport {Event} from '../event/Event';\nimport {TouchEvent} from '../event/TouchEvent';\nimport {EventEmitter} from '../event/EventEmitter';\n\nexport class Layer extends EventEmitter {\n\n\tpublic static pixelRatio: number = typeof window === 'undefined' ? 1 : window.devicePixelRatio || 1;\n\n\tpublic name: string = '';\n\tpublic tag: string = '';\n\tpublic touchable: boolean = true;\n\n\tprotected $x: number = 0;\n\tprotected $y: number = 0;\n\tprotected $width: number = 0;\n\tprotected $height: number = 0;\n\tprotected $anchorX: number = 0;\n\tprotected $anchorY: number = 0;\n\tprotected $skewX: number = 0;\n\tprotected $skewY: number = 0;\n\tprotected $scaleX: number = 1;\n\tprotected $scaleY: number = 1;\n\tprotected $rotation: number = 0;\n\tprotected $alpha: number = 1;\n\tprotected $visible: boolean = true;\n\tprotected $smoothing: boolean = true;\n\tprotected $background: string = null;\n\tprotected $stage: Stage = null;\n\tprotected $parent: Layer = null;\n\tprotected $children: Array<Layer> = [];\n\tprotected $dirty: boolean = true;\n\tprotected $shouldEmitTap: boolean = true;\n\tprotected $touches: Array<boolean> = [];\n\tprotected readonly $canvas: HTMLCanvasElement;\n\tprotected readonly $context: CanvasRenderingContext2D;\n\n\tpublic constructor() {\n\t\tsuper();\n\t\tthis.$canvas = document.createElement('canvas');\n\t\tthis.$context = this.$canvas.getContext('2d');\n\t}\n\n\tpublic get x(): number {\n\t\treturn this.$x;\n\t}\n\n\tpublic set x(x: number) {\n\t\tif (this.$x !== x) {\n\t\t\tthis.$x = x;\n\t\t\tthis.$markParentDirty();\n\t\t}\n\t}\n\n\tpublic get y(): number {\n\t\treturn this.$y;\n\t}\n\n\tpublic set y(y: number) {\n\t\tif (this.$y !== y) {\n\t\t\tthis.$y = y;\n\t\t\tthis.$markParentDirty();\n\t\t}\n\t}\n\n\tpublic get width(): number {\n\t\treturn this.$width ? this.$width : this.$canvas.width / Layer.pixelRatio;\n\t}\n\n\tpublic set width(width: number) {\n\t\tif (this.$width !== width) {\n\t\t\tthis.$width = width;\n\t\t\tthis.$resizeCanvas();\n\t\t}\n\t}\n\n\tpublic get height(): number {\n\t\treturn this.$height ? this.$height : this.$canvas.height / Layer.pixelRatio;\n\t}\n\n\tpublic set height(height: number) {\n\t\tif (this.$height !== height) {\n\t\t\tthis.$height = height;\n\t\t\tthis.$resizeCanvas();\n\t\t}\n\t}\n\n\tpublic get anchorX(): number {\n\t\treturn this.$anchorX;\n\t}\n\n\tpublic set anchorX(anchorX: number) {\n\t\tif (this.$anchorX !== anchorX) {\n\t\t\tthis.$anchorX = anchorX;\n\t\t\tthis.$resizeCanvas();\n\t\t}\n\t}\n\n\tpublic get anchorY(): number {\n\t\treturn this.$anchorY;\n\t}\n\n\tpublic set anchorY(anchorY: number) {\n\t\tif (this.$anchorY !== anchorY) {\n\t\t\tthis.$anchorY = anchorY;\n\t\t\tthis.$resizeCanvas();\n\t\t}\n\t}\n\n\tpublic get skewX(): number {\n\t\treturn this.$skewX;\n\t}\n\n\tpublic set skewX(skewX: number) {\n\t\tif (this.$skewX !== skewX) {\n\t\t\tthis.$skewX = skewX;\n\t\t\tthis.$markParentDirty();\n\t\t}\n\t}\n\n\tpublic get skewY(): number {\n\t\treturn this.$skewY;\n\t}\n\n\tpublic set skewY(skewY: number) {\n\t\tif (this.$skewY !== skewY) {\n\t\t\tthis.$skewY = skewY;\n\t\t\tthis.$markParentDirty();\n\t\t}\n\t}\n\n\tpublic get scaleX(): number {\n\t\treturn this.$scaleX;\n\t}\n\n\tpublic set scaleX(scaleX: number) {\n\t\tif (this.$scaleX !== scaleX) {\n\t\t\tthis.$scaleX = scaleX;\n\t\t\tthis.$markParentDirty();\n\t\t}\n\t}\n\n\tpublic get scaleY(): number {\n\t\treturn this.$scaleY;\n\t}\n\n\tpublic set scaleY(scaleY: number) {\n\t\tif (this.$scaleY !== scaleY) {\n\t\t\tthis.$scaleY = scaleY;\n\t\t\tthis.$markParentDirty();\n\t\t}\n\t}\n\n\tpublic get rotation(): number {\n\t\treturn this.$rotation;\n\t}\n\n\tpublic set rotation(rotation: number) {\n\t\tif (this.$rotation !== rotation) {\n\t\t\tthis.$rotation = rotation;\n\t\t\tthis.$markParentDirty();\n\t\t}\n\t}\n\n\tpublic get alpha(): number {\n\t\treturn this.$alpha;\n\t}\n\n\tpublic set alpha(alpha: number) {\n\t\tif (this.$alpha !== alpha) {\n\t\t\tthis.$alpha = alpha;\n\t\t\tthis.$markParentDirty();\n\t\t}\n\t}\n\n\tpublic get visible(): boolean {\n\t\treturn this.$visible;\n\t}\n\n\tpublic set visible(visible: boolean) {\n\t\tif (this.$visible !== visible) {\n\t\t\tthis.$visible = visible;\n\t\t\tthis.$markParentDirty();\n\t\t}\n\t}\n\n\tpublic get smoothing(): boolean {\n\t\treturn this.$smoothing;\n\t}\n\n\tpublic set smoothing(smoothing: boolean) {\n\t\tthis.$smoothing = smoothing;\n\t\tthis.$resizeCanvas();\n\t}\n\n\tpublic get background(): string {\n\t\treturn this.$background;\n\t}\n\n\tpublic set background(background: string) {\n\t\tif (this.$background !== background) {\n\t\t\tthis.$background = background;\n\t\t\tthis.$markDirty();\n\t\t}\n\t}\n\n\tpublic get stage(): Stage {\n\t\treturn this.$stage;\n\t}\n\n\tpublic get parent(): Layer {\n\t\treturn this.$parent;\n\t}\n\n\tpublic get numChildren(): number {\n\t\treturn this.$children.length;\n\t}\n\n\tpublic get ticker(): Ticker {\n\t\treturn this.$stage ? this.$stage.ticker : null;\n\t}\n\n\tpublic get canvas(): HTMLCanvasElement {\n\t\treturn this.$canvas;\n\t}\n\n\tpublic addChild(child: Layer): this {\n\t\treturn this.addChildAt(child, this.$children.length);\n\t}\n\n\tpublic addChildAt(child: Layer, index: number): this {\n\t\tlet children = this.$children;\n\t\tif (child.$parent) {\n\t\t\tchild.$parent.removeChild(child);\n\t\t}\n\t\tif (index < 0 || index > children.length) {\n\t\t\tindex = children.length;\n\t\t}\n\t\tchild.$emitAdded(this);\n\t\tchildren.splice(index, 0, child);\n\t\tthis.$resizeCanvas();\n\t\treturn this;\n\t}\n\n\tpublic replaceChild(oldChild: Layer, newChild: Layer): this {\n\t\tlet index = this.getChildIndex(oldChild);\n\t\tthis.removeChildAt(index);\n\t\tthis.addChildAt(newChild, index);\n\t\treturn this;\n\t}\n\n\tpublic getChildByName(name: string): Layer {\n\t\tlet children = this.$children;\n\t\tfor (let child of children) {\n\t\t\tif (child.name === name) {\n\t\t\t\treturn child;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tpublic getChildrenByTag(tag: string): Array<Layer> {\n\t\tlet result = [];\n\t\tlet children = this.$children;\n\t\tfor (let child of children) {\n\t\t\tif (child.tag === tag) {\n\t\t\t\tresult.push(child);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tpublic getChildAt(index: number): Layer {\n\t\treturn this.$children[index] || null;\n\t}\n\n\tpublic getChildIndex(child: Layer): number {\n\t\treturn this.$children.indexOf(child);\n\t}\n\n\tpublic hasChild(child: Layer): boolean {\n\t\treturn this.getChildIndex(child) >= 0;\n\t}\n\n\tpublic swapChildren(child1: Layer, child2: Layer): this {\n\t\tlet index1 = this.getChildIndex(child1);\n\t\tlet index2 = this.getChildIndex(child2);\n\t\tif (index1 >= 0 && index2 >= 0) {\n\t\t\tthis.swapChildrenAt(index1, index2);\n\t\t}\n\t\treturn this;\n\t}\n\n\tpublic swapChildrenAt(index1: number, index2: number): this {\n\t\tlet child1 = this.$children[index1];\n\t\tlet child2 = this.$children[index2];\n\t\tif (index1 !== index2 && child1 && child2) {\n\t\t\tthis.$children[index1] = child2;\n\t\t\tthis.$children[index2] = child1;\n\t\t\tthis.$markDirty();\n\t\t}\n\t\treturn this;\n\t}\n\n\tpublic setChildIndex(child: Layer, index: number): this {\n\t\tlet children = this.$children;\n\t\tlet oldIndex = this.getChildIndex(child);\n\t\tif (index < 0) {\n\t\t\tindex = 0;\n\t\t} else if (index > children.length) {\n\t\t\tindex = children.length;\n\t\t}\n\t\tif (oldIndex >= 0 && index > oldIndex) {\n\t\t\tfor (let i = oldIndex + 1; i <= index; ++i) {\n\t\t\t\tchildren[i - 1] = children[i];\n\t\t\t}\n\t\t\tchildren[index] = child;\n\t\t\tthis.$markDirty();\n\t\t} else if (oldIndex >= 0 && index < oldIndex) {\n\t\t\tfor (let i = oldIndex - 1; i >= index; --i) {\n\t\t\t\tchildren[i + 1] = children[i];\n\t\t\t}\n\t\t\tchildren[index] = child;\n\t\t\tthis.$markDirty();\n\t\t}\n\t\treturn this;\n\t}\n\n\tpublic removeChild(child: Layer): this {\n\t\tlet index = this.getChildIndex(child);\n\t\treturn this.removeChildAt(index);\n\t}\n\n\tpublic removeChildAt(index: number): this {\n\t\tlet children = this.$children;\n\t\tlet child = children[index];\n\t\tif (child) {\n\t\t\tchildren.splice(index, 1);\n\t\t\tchild.$emitRemoved();\n\t\t\tthis.$resizeCanvas();\n\t\t}\n\t\treturn this;\n\t}\n\n\tpublic removeChildByName(name: string): this {\n\t\tlet children = this.$children;\n\t\tfor (let i = 0, l = children.length; i < l; ++i) {\n\t\t\tlet child = children[i];\n\t\t\tif (child.name === name) {\n\t\t\t\tthis.removeChildAt(i);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tpublic removeChildrenByTag(tag: string): this {\n\t\tlet children = this.$children;\n\t\tfor (let i = children.length - 1; i >= 0; --i) {\n\t\t\tlet child = children[i];\n\t\t\tif (child.tag === tag) {\n\t\t\t\tthis.removeChildAt(i);\n\t\t\t}\n\t\t}\n\t\treturn this;\n\t}\n\n\tpublic removeAllChildren(): this {\n\t\tlet children = this.$children;\n\t\tfor (let child of children) {\n\t\t\tchild.$emitRemoved();\n\t\t}\n\t\tthis.$children.length = 0;\n\t\tthis.$resizeCanvas();\n\t\treturn this;\n\t}\n\n\tpublic removeSelf(): this {\n\t\tif (this.$parent) {\n\t\t\tthis.$parent.removeChild(this);\n\t\t}\n\t\treturn this;\n\t}\n\n\tprotected $markDirty(sizeDirty?: boolean): void {\n\t\tif (sizeDirty) {\n\t\t\tthis.$resizeParentCanvas();\n\t\t} else if (!this.$dirty) {\n\t\t\tthis.$markParentDirty();\n\t\t}\n\t\tthis.$dirty = true;\n\t}\n\n\tprotected $markParentDirty(): void {\n\t\tif (this.$parent) {\n\t\t\tthis.$parent.$markDirty();\n\t\t}\n\t}\n\n\tprotected $resizeCanvas(): void {\n\t\tlet width = this.$width;\n\t\tlet height = this.$height;\n\t\tlet canvas = this.$canvas;\n\t\tlet anchorX = this.$anchorX;\n\t\tlet anchorY = this.$anchorY;\n\t\tlet context = this.$context;\n\t\tlet smoothing = this.$smoothing;\n\t\tlet pixelRatio = Layer.pixelRatio;\n\t\tif (width && height) {\n\t\t\tcanvas.width = width * pixelRatio;\n\t\t\tcanvas.height = height * pixelRatio;\n\t\t} else {\n\t\t\tlet bounds = this.$getContentBounds();\n\t\t\tcanvas.width = (width || bounds.right + anchorX) * pixelRatio;\n\t\t\tcanvas.height = (height || bounds.bottom + anchorY) * pixelRatio;\n\t\t\tbounds.release();\n\t\t}\n\t\tif (context.imageSmoothingEnabled !== smoothing) {\n\t\t\tcontext.imageSmoothingEnabled = smoothing;\n\t\t}\n\t\tthis.$markDirty(true);\n\t}\n\n\tprotected $resizeParentCanvas(): void {\n\t\tif (this.$parent) {\n\t\t\tthis.$parent.$resizeCanvas();\n\t\t}\n\t}\n\n\tprotected $getTransform(): Matrix {\n\t\tlet degToRad = Math.PI / 180;\n\t\tlet matrix = Matrix.create();\n\t\tmatrix.translate(-this.$anchorX, -this.$anchorY);\n\t\tmatrix.skew(this.skewX * degToRad, this.skewY * degToRad);\n\t\tmatrix.rotate(this.rotation * degToRad);\n\t\tmatrix.scale(this.scaleX, this.scaleY);\n\t\tmatrix.translate(this.x, this.y);\n\t\treturn matrix;\n\t}\n\n\tprotected $getChildTransform(child: Layer): Matrix {\n\t\treturn child.$getTransform();\n\t}\n\n\tprotected $getChildBounds(child: Layer): Rectangle {\n\t\tlet width = child.width;\n\t\tlet height = child.height;\n\t\tlet bounds = Rectangle.create();\n\t\tlet matrix = this.$getChildTransform(child);\n\t\tlet topLeft = Vector.create(0, 0).transform(matrix);\n\t\tlet topRight = Vector.create(width, 0).transform(matrix);\n\t\tlet bottomLeft = Vector.create(0, height).transform(matrix);\n\t\tlet bottomRight = Vector.create(width, height).transform(matrix);\n\t\tlet minX = Math.min(topLeft.x, topRight.x, bottomLeft.x, bottomRight.x);\n\t\tlet maxX = Math.max(topLeft.x, topRight.x, bottomLeft.x, bottomRight.x);\n\t\tlet minY = Math.min(topLeft.y, topRight.y, bottomLeft.y, bottomRight.y);\n\t\tlet maxY = Math.max(topLeft.y, topRight.y, bottomLeft.y, bottomRight.y);\n\t\tbounds.top = minY;\n\t\tbounds.bottom = maxY;\n\t\tbounds.left = minX;\n\t\tbounds.right = maxX;\n\t\tmatrix.release();\n\t\ttopLeft.release();\n\t\ttopRight.release();\n\t\tbottomLeft.release();\n\t\tbottomRight.release();\n\t\treturn bounds;\n\t}\n\n\tprotected $getContentBounds(): Rectangle {\n\t\tlet bounds;\n\t\tlet children = this.$children;\n\t\tfor (let child of children) {\n\t\t\tif (child.$visible) {\n\t\t\t\tlet childBounds = this.$getChildBounds(child);\n\t\t\t\tif (bounds) {\n\t\t\t\t\tbounds.top = Math.min(bounds.top, childBounds.top);\n\t\t\t\t\tbounds.bottom = Math.max(bounds.bottom, childBounds.bottom);\n\t\t\t\t\tbounds.left = Math.min(bounds.left, childBounds.left);\n\t\t\t\t\tbounds.right = Math.max(bounds.right, childBounds.right);\n\t\t\t\t\tchildBounds.release();\n\t\t\t\t} else {\n\t\t\t\t\tbounds = childBounds;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tbounds = bounds || Rectangle.create();\n\t\treturn bounds;\n\t}\n\n\tprotected $emitTouchEvent(event: TouchEvent, inside: boolean): boolean {\n\t\tlet type = event.type;\n\t\tlet localX = event.localX;\n\t\tlet localY = event.localY;\n\t\tlet touches = this.$touches;\n\t\tlet identifier = event.identifier;\n\t\tif (type === TouchEvent.TOUCH_START) {\n\t\t\tthis.$shouldEmitTap = true;\n\t\t\ttouches[identifier] = true;\n\t\t} else if (!touches[identifier]) {\n\t\t\treturn false;\n\t\t} else if (type === TouchEvent.TOUCH_TAP || type === TouchEvent.TOUCH_CANCEL) {\n\t\t\ttouches[identifier] = false;\n\t\t}\n\t\tif (type === TouchEvent.TOUCH_MOVE) {\n\t\t\tthis.$shouldEmitTap = false;\n\t\t}\n\t\tlet children = this.$children;\n\t\tfor (let i = children.length - 1; i >= 0; --i) {\n\t\t\tlet child = children[i];\n\t\t\tif (!child.$visible || !child.touchable) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet matrix = this.$getChildTransform(child);\n\t\t\tlet localPos = Vector.create(localX, localY).transform(matrix.invert()).subtract(child.$anchorX, child.$anchorY);\n\t\t\tlet inside = child.$localHitTest(localPos);\n\t\t\tlocalPos.release();\n\t\t\tmatrix.release();\n\t\t\tif (inside || type !== TouchEvent.TOUCH_START) {\n\t\t\t\tevent.target = child;\n\t\t\t\tevent.localX = event.targetX = localPos.x;\n\t\t\t\tevent.localY = event.targetY = localPos.y;\n\t\t\t\tif (child.$emitTouchEvent(event, inside)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (type === TouchEvent.TOUCH_TAP && (!inside || !this.$shouldEmitTap)) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!event.cancelBubble) {\n\t\t\tevent.localX = localX;\n\t\t\tevent.localY = localY;\n\t\t\tthis.emit(event);\n\t\t}\n\t\treturn true;\n\t}\n\n\tprotected $emitAdded(parent: Layer): void {\n\t\tlet stage = parent.$stage;\n\t\tthis.$parent = parent;\n\t\tthis.emit(Event.ADDED);\n\t\tif (stage) {\n\t\t\tthis.$emitAddedToStage(stage);\n\t\t}\n\t}\n\n\tprotected $emitRemoved(): void {\n\t\tlet stage = this.$stage;\n\t\tthis.$parent = null;\n\t\tthis.emit(Event.REMOVED);\n\t\tif (stage) {\n\t\t\tthis.$emitRemovedFromStage();\n\t\t}\n\t}\n\n\tprotected $emitAddedToStage(stage: Stage): void {\n\t\tlet children = this.$children;\n\t\tthis.$stage = stage;\n\t\tthis.emit(Event.ADDED_TO_STAGE);\n\n\t\tif (this.hasEventListener(Event.ENTER_FRAME)) {\n\t\t\tstage.ticker.registerEnterFrameCallback(this);\n\t\t}\n\t\tfor (let child of children) {\n\t\t\tchild.$emitAddedToStage(stage);\n\t\t}\n\t}\n\n\tprotected $emitRemovedFromStage(): void {\n\t\tlet stage = this.$stage;\n\t\tlet children = this.$children;\n\t\tthis.$stage = null;\n\t\tthis.emit(Event.REMOVED_FROM_STAGE);\n\t\tif (this.hasEventListener(Event.ENTER_FRAME)) {\n\t\t\tstage.ticker.unregisterEnterFrameCallback(this);\n\t\t}\n\t\tfor (let child of children) {\n\t\t\tchild.$emitRemovedFromStage();\n\t\t}\n\t}\n\n\tprotected $localHitTest(vector: Vector): boolean {\n\t\treturn vector.x >= -this.anchorX && vector.x <= this.width - this.anchorX && vector.y >= -this.anchorY && vector.y <= this.height - this.anchorY;\n\t}\n\n\tprotected $isChildVisible(child: Layer): boolean {\n\t\tif (!child.visible || !child.alpha || !child.width || !child.height) {\n\t\t\treturn false;\n\t\t}\n\t\tlet minX = -this.$anchorX;\n\t\tlet maxX = this.width + minX;\n\t\tlet minY = -this.$anchorY;\n\t\tlet maxY = this.height + minY;\n\t\tlet bounds = this.$getChildBounds(child);\n\t\tlet inside = bounds.left <= maxX && bounds.right >= minX && bounds.top <= maxY && bounds.bottom >= minY;\n\t\tbounds.release();\n\t\treturn inside;\n\t}\n\n\tprotected $drawChild(child: Layer): number {\n\t\tlet ctx = this.$context;\n\t\tlet canvas = child.$canvas;\n\t\tlet width = child.width;\n\t\tlet height = child.height;\n\t\tlet pixelRatio = Layer.pixelRatio;\n\t\tlet matrix = this.$getChildTransform(child).scale(pixelRatio);\n\t\tlet drawCalls = child.$render();\n\t\tlet globalAlpha = ctx.globalAlpha;\n\t\tif (globalAlpha !== child.alpha) {\n\t\t\tctx.globalAlpha = child.alpha;\n\t\t}\n\t\tif (matrix.b === 0 && matrix.c === 0) {\n\t\t\tlet tx = (matrix.tx + 0.5) | 0;\n\t\t\tlet ty = (matrix.ty + 0.5) | 0;\n\t\t\twidth = (width * matrix.a) + 0.5 | 0;\n\t\t\theight = (height * matrix.d) + 0.5 | 0;\n\t\t\tctx.drawImage(canvas, tx, ty, width, height);\n\t\t} else {\n\t\t\tctx.save();\n\t\t\tctx.transform(matrix.a, matrix.b, matrix.c, matrix.d, matrix.tx, matrix.ty);\n\t\t\tctx.drawImage(canvas, 0, 0, width, height);\n\t\t\tctx.restore();\n\t\t}\n\t\tif (globalAlpha !== child.alpha) {\n\t\t\tctx.globalAlpha = globalAlpha;\n\t\t}\n\t\tmatrix.release();\n\t\treturn drawCalls + 1;\n\t}\n\n\tprotected $render(): number {\n\t\tif (!this.$dirty) {\n\t\t\treturn 0;\n\t\t}\n\t\tlet drawCalls = 0;\n\t\tlet ctx = this.$context;\n\t\tlet canvas = this.$canvas;\n\t\tlet children = this.$children;\n\t\tlet canvasWidth = canvas.width;\n\t\tlet canvasHeight = canvas.height;\n\t\tlet anchorX = (this.$anchorX + 0.5) | 0;\n\t\tlet anchorY = (this.$anchorY + 0.5) | 0;\n\t\tlet background = this.$background;\n\t\tlet pixelRatio = Layer.pixelRatio;\n\n\t\tctx.globalAlpha = 1;\n\t\tctx.setTransform(1, 0, 0, 1, 0, 0);\n\t\tctx.clearRect(0, 0, canvasWidth, canvasHeight);\n\t\tif (background) {\n\t\t\tctx.fillStyle = background;\n\t\t\tctx.fillRect(0, 0, canvasWidth, canvasHeight);\n\t\t}\n\t\tctx.translate(anchorX * pixelRatio, anchorY * pixelRatio);\n\t\tfor (let child of children) {\n\t\t\tif (this.$isChildVisible(child)) {\n\t\t\t\tdrawCalls += this.$drawChild(child);\n\t\t\t}\n\t\t}\n\t\tthis.$dirty = false;\n\t\treturn drawCalls;\n\t}\n\n\tpublic on(type: string, listener: (...args: any[]) => void): this {\n\t\tsuper.on(type, listener);\n\t\tif (type === Event.ENTER_FRAME && this.ticker) {\n\t\t\tthis.ticker.registerEnterFrameCallback(this);\n\t\t} else if (type === Event.ADDED && this.$parent) {\n\t\t\tlet event = Event.create(type);\n\t\t\tlistener.call(this, event);\n\t\t\tevent.release();\n\t\t} else if (type === Event.ADDED_TO_STAGE && this.$stage) {\n\t\t\tlet event = Event.create(type);\n\t\t\tlistener.call(this, event);\n\t\t\tevent.release();\n\t\t}\n\t\treturn this;\n\t}\n\n\tpublic off(type: string, listener?: (...args: any[]) => void): this {\n\t\tsuper.off(type, listener);\n\t\tif (type === Event.ENTER_FRAME && !this.hasEventListener(Event.ENTER_FRAME) && this.ticker) {\n\t\t\tthis.ticker.unregisterEnterFrameCallback(this);\n\t\t}\n\t\treturn this;\n\t}\n\n}\n","export class Ease {\n\n\tpublic static linear(t: number, b: number, c: number, d: number): number {\n\t\treturn c * t / d + b;\n\t}\n\n\tpublic static easeInQuad(t: number, b: number, c: number, d: number): number {\n\t\treturn c * (t /= d) * t + b;\n\t}\n\n\tpublic static easeOutQuad(t: number, b: number, c: number, d: number): number {\n\t\treturn -c * (t /= d) * (t - 2) + b;\n\t}\n\n\tpublic static easeInOutQuad(t: number, b: number, c: number, d: number): number {\n\t\tif ((t /= d / 2) < 1) return c / 2 * t * t + b;\n\t\treturn -c / 2 * ((--t) * (t - 2) - 1) + b;\n\t}\n\n\tpublic static easeInCubic(t: number, b: number, c: number, d: number): number {\n\t\treturn c * (t /= d) * t * t + b;\n\t}\n\n\tpublic static easeOutCubic(t: number, b: number, c: number, d: number): number {\n\t\treturn c * ((t = t / d - 1) * t * t + 1) + b;\n\t}\n\n\tpublic static easeInOutCubic(t: number, b: number, c: number, d: number): number {\n\t\tif ((t /= d / 2) < 1) return c / 2 * t * t * t + b;\n\t\treturn c / 2 * ((t -= 2) * t * t + 2) + b;\n\t}\n\n\tpublic static easeInQuart(t: number, b: number, c: number, d: number): number {\n\t\treturn c * (t /= d) * t * t * t + b;\n\t}\n\n\tpublic static easeOutQuart(t: number, b: number, c: number, d: number): number {\n\t\treturn -c * ((t = t / d - 1) * t * t * t - 1) + b;\n\t}\n\n\tpublic static easeInOutQuart(t: number, b: number, c: number, d: number): number {\n\t\tif ((t /= d / 2) < 1) return c / 2 * t * t * t * t + b;\n\t\treturn -c / 2 * ((t -= 2) * t * t * t - 2) + b;\n\t}\n\n\tpublic static easeInQuint(t: number, b: number, c: number, d: number): number {\n\t\treturn c * (t /= d) * t * t * t * t + b;\n\t}\n\n\tpublic static easeOutQuint(t: number, b: number, c: number, d: number): number {\n\t\treturn c * ((t = t / d - 1) * t * t * t * t + 1) + b;\n\t}\n\n\tpublic static easeInOutQuint(t: number, b: number, c: number, d: number): number {\n\t\tif ((t /= d / 2) < 1) return c / 2 * t * t * t * t * t + b;\n\t\treturn c / 2 * ((t -= 2) * t * t * t * t + 2) + b;\n\t}\n\n\tpublic static easeInSine(t: number, b: number, c: number, d: number): number {\n\t\treturn (t === d) ? b + c : -c * Math.cos(t / d * (Math.PI / 2)) + c + b;\n\t}\n\n\tpublic static easeOutSine(t: number, b: number, c: number, d: number): number {\n\t\treturn c * Math.sin(t / d * (Math.PI / 2)) + b;\n\t}\n\n\tpublic static easeInOutSine(t: number, b: number, c: number, d: number): number {\n\t\treturn -c / 2 * (Math.cos(Math.PI * t / d) - 1) + b;\n\t}\n\n\tpublic static easeInExpo(t: number, b: number, c: number, d: number): number {\n\t\treturn (t === 0) ? b : c * Math.pow(2, 10 * (t / d - 1)) + b;\n\t}\n\n\tpublic static easeOutExpo(t: number, b: number, c: number, d: number): number {\n\t\treturn (t === d) ? b + c : c * (-Math.pow(2, -10 * t / d) + 1) + b;\n\t}\n\n\tpublic static easeInOutExpo(t: number, b: number, c: number, d: number): number {\n\t\tif (t === 0) return b;\n\t\tif (t === d) return b + c;\n\t\tif ((t /= d / 2) < 1) return c / 2 * Math.pow(2, 10 * (t - 1)) + b;\n\t\treturn c / 2 * (-Math.pow(2, -10 * --t) + 2) + b;\n\t}\n\n\tpublic static easeInCirc(t: number, b: number, c: number, d: number): number {\n\t\treturn -c * (Math.sqrt(1 - (t /= d) * t) - 1) + b;\n\t}\n\n\tpublic static easeOutCirc(t: number, b: number, c: number, d: number): number {\n\t\treturn c * Math.sqrt(1 - (t = t / d - 1) * t) + b;\n\t}\n\n\tpublic static easeInOutCirc(t: number, b: number, c: number, d: number): number {\n\t\tif ((t /= d / 2) < 1) return -c / 2 * (Math.sqrt(1 - t * t) - 1) + b;\n\t\treturn c / 2 * (Math.sqrt(1 - (t -= 2) * t) + 1) + b;\n\t}\n\n\tpublic static easeInElastic(t: number, b: number, c: number, d: number): number {\n\t\tlet s = 1.70158;\n\t\tlet p = 0;\n\t\tlet a = c;\n\t\tif (t === 0) return b;\n\t\tif ((t /= d) === 1) return b + c;\n\t\tif (!p) p = d * 0.3;\n\t\tif (a < Math.abs(c)) {\n\t\t\ta = c;\n\t\t\ts = p / 4;\n\t\t} else {\n\t\t\ts = p / (2 * Math.PI) * Math.asin(c / a);\n\t\t}\n\t\treturn -(a * Math.pow(2, 10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p)) + b;\n\t}\n\n\tpublic static easeOutElastic(t: number, b: number, c: number, d: number): number {\n\t\tlet s = 1.70158;\n\t\tlet p = 0;\n\t\tlet a = c;\n\t\tif (t === 0) return b;\n\t\tif ((t /= d) === 1) return b + c;\n\t\tif (!p) p = d * 0.3;\n\t\tif (a < Math.abs(c)) {\n\t\t\ta = c;\n\t\t\ts = p / 4;\n\t\t} else {\n\t\t\ts = p / (2 * Math.PI) * Math.asin(c / a);\n\t\t}\n\t\treturn a * Math.pow(2, -10 * t) * Math.sin((t * d - s) * (2 * Math.PI) / p) + c + b;\n\t}\n\n\tpublic static easeInOutElastic(t: number, b: number, c: number, d: number): number {\n\t\tlet s = 1.70158;\n\t\tlet p = 0;\n\t\tlet a = c;\n\t\tif (t === 0) return b;\n\t\tif ((t /= d / 2) === 2) return b + c;\n\t\tif (!p) p = d * (0.3 * 1.5);\n\t\tif (a < Math.abs(c)) {\n\t\t\ta = c;\n\t\t\ts = p / 4;\n\t\t} else {\n\t\t\ts = p / (2 * Math.PI) * Math.asin(c / a);\n\t\t}\n\t\tif (t < 1) return -0.5 * (a * Math.pow(2, 10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p)) + b;\n\t\treturn a * Math.pow(2, -10 * (t -= 1)) * Math.sin((t * d - s) * (2 * Math.PI) / p) * 0.5 + c + b;\n\t}\n\n\tpublic static easeInBack(t: number, b: number, c: number, d: number, s: number = 1.70158): number {\n\t\treturn (t === d) ? b + c : c * (t /= d) * t * ((s + 1) * t - s) + b;\n\t}\n\n\tpublic static easeOutBack(t: number, b: number, c: number, d: number, s: number = 1.70158): number {\n\t\treturn (t === 0) ? b : c * ((t = t / d - 1) * t * ((s + 1) * t + s) + 1) + b;\n\t}\n\n\tpublic static easeInOutBack(t: number, b: number, c: number, d: number, s: number = 1.70158): number {\n\t\tif ((t /= d / 2) < 1) return c / 2 * (t * t * (((s *= (1.525)) + 1) * t - s)) + b;\n\t\treturn c / 2 * ((t -= 2) * t * (((s *= (1.525)) + 1) * t + s) + 2) + b;\n\t}\n\n\tpublic static easeInBounce(t: number, b: number, c: number, d: number): number {\n\t\treturn c - Ease.easeOutBounce(d - t, 0, c, d) + b;\n\t}\n\n\tpublic static easeOutBounce(t: number, b: number, c: number, d: number): number {\n\t\tif ((t /= d) < (1 / 2.75)) {\n\t\t\treturn c * (7.5625 * t * t) + b;\n\t\t} else if (t < (2 / 2.75)) {\n\t\t\treturn c * (7.5625 * (t -= (1.5 / 2.75)) * t + 0.75) + b;\n\t\t} else if (t < (2.5 / 2.75)) {\n\t\t\treturn c * (7.5625 * (t -= (2.25 / 2.75)) * t + 0.9375) + b;\n\t\t} else {\n\t\t\treturn c * (7.5625 * (t -= (2.625 / 2.75)) * t + 0.984375) + b;\n\t\t}\n\t}\n\n\tpublic static easeInOutBounce(t: number, b: number, c: number, d: number): number {\n\t\tif (t < d / 2) return Ease.easeInBounce(t * 2, 0, c, d) * 0.5 + b;\n\t\treturn Ease.easeOutBounce(t * 2 - d, 0, c, d) * 0.5 + c * 0.5 + b;\n\t}\n\n}","import {Ease} from './Ease';\nimport {Layer} from '../display/Layer';\nimport {Event} from '../event/Event';\nimport {EventEmitter} from '../event/EventEmitter';\n\nexport class Tween extends EventEmitter {\n\n\tpublic loop: boolean = false;\n\n\tprotected $target: Layer = null;\n\tprotected $paused: boolean = true;\n\tprotected $stopped: boolean = true;\n\tprotected $stepIndex: number = 0;\n\tprotected $stepPosition: number = 0;\n\tprotected $steps: Array<TweenStep> = [];\n\tprotected $stepProps: Array<Object> = [];\n\tprotected $shouldSaveProps: boolean = true;\n\tprotected $boundOnEnterFrame: () => void;\n\n\tprotected constructor(target: Layer, option?: TweenOption) {\n\t\tsuper();\n\t\tthis.$target = target;\n\t\tthis.loop = option ? option.loop : false;\n\t\tthis.$boundOnEnterFrame = this.$onEnterFrame.bind(this);\n\t}\n\n\tpublic get paused(): boolean {\n\t\treturn this.$paused;\n\t}\n\n\tpublic get stopped(): boolean {\n\t\treturn this.$stopped;\n\t}\n\n\tpublic set(props: Object): this {\n\t\tthis.$steps.push({\n\t\t\ttype: 'set',\n\t\t\tprops\n\t\t});\n\t\treturn this;\n\t}\n\n\tpublic to(props: Object, duration: number, ease?: Function): this {\n\t\tthis.$steps.push({\n\t\t\ttype: 'to',\n\t\t\tduration,\n\t\t\tprops,\n\t\t\tease\n\t\t});\n\t\treturn this;\n\t}\n\n\tpublic wait(duration: number): this {\n\t\tthis.$steps.push({\n\t\t\ttype: 'wait',\n\t\t\tduration\n\t\t});\n\t\treturn this;\n\t}\n\n\tpublic call(callback: Function): this {\n\t\tthis.$steps.push({\n\t\t\ttype: 'call',\n\t\t\tcallback\n\t\t});\n\t\treturn this;\n\t}\n\n\tpublic play(): this {\n\t\tif (this.$stopped) {\n\t\t\tthis.resume();\n\t\t\tTween.$tweens.push(this);\n\t\t}\n\t\treturn this;\n\t}\n\n\tpublic pause(): this {\n\t\tthis.$paused = true;\n\t\tthis.$target.off(Event.ENTER_FRAME, this.$boundOnEnterFrame);\n\t\treturn this;\n\t}\n\n\tpublic resume(): this {\n\t\tif (this.$paused) {\n\t\t\tthis.$paused = false;\n\t\t\tthis.$stopped = false;\n\t\t\tthis.$target.on(Event.ENTER_FRAME, this.$boundOnEnterFrame);\n\t\t}\n\t\treturn this;\n\t}\n\n\tpublic stop(): this {\n\t\tthis.pause();\n\t\tthis.$stopped = true;\n\t\tlet index = Tween.$tweens.indexOf(this);\n\t\tif (index >= 0) {\n\t\t\tTween.$tweens.splice(index, 1);\n\t\t}\n\t\treturn this;\n\t}\n\n\tprotected $onEnterFrame(e: Event): void {\n\t\tthis.$nextFrame(e.data);\n\t}\n\n\tprotected $nextFrame(dt: number): void {\n\t\tlet loop = this.loop;\n\t\tlet steps = this.$steps;\n\t\tlet stepLength = this.$steps.length;\n\t\tlet stepIndex = this.$stepIndex;\n\t\tlet stepPosition = this.$stepPosition + dt;\n\t\tlet step = steps[stepIndex];\n\t\tlet type = step.type;\n\t\tlet duration = step.duration || 0;\n\t\tlet props = step.props;\n\t\tlet ease = step.ease || Ease.linear;\n\t\tlet callback = step.callback;\n\t\tif (type === 'set') {\n\t\t\tthis.$setProps(props);\n\t\t} else if (type === 'to') {\n\t\t\tthis.$easeProps(stepIndex, props, stepPosition, duration, ease);\n\t\t} else if (type === 'call') {\n\t\t\tcallback.call(this.$target);\n\t\t}\n\t\tif (stepPosition < duration) {\n\t\t\tthis.$stepPosition = stepPosition;\n\t\t} else if (stepIndex + 1 < stepLength) {\n\t\t\tthis.$stepPosition = 0;\n\t\t\tthis.$stepIndex = stepIndex + 1;\n\t\t\tthis.$shouldSaveProps = true;\n\t\t\tthis.$setProps(props);\n\t\t\tthis.$nextFrame(stepPosition - duration);\n\t\t} else if (loop) {\n\t\t\tthis.$stepIndex = 0;\n\t\t\tthis.$stepPosition = 0;\n\t\t\tthis.$shouldSaveProps = true;\n\t\t\tthis.$setProps(props);\n\t\t\tthis.$nextFrame(stepPosition - duration);\n\t\t} else {\n\t\t\tthis.$stepIndex = 0;\n\t\t\tthis.$stepPosition = 0;\n\t\t\tthis.$shouldSaveProps = true;\n\t\t\tthis.$setProps(props);\n\t\t\tthis.pause();\n\t\t}\n\t}\n\n\tprotected $saveOriginalProps(stepIndex: number, props: Object): void {\n\t\tlet target = this.$target;\n\t\tlet stepProps = this.$stepProps;\n\t\tlet originalProps = stepProps[stepIndex] = stepProps[stepIndex] || {};\n\t\tfor (let key in props) {\n\t\t\toriginalProps[key] = target[key];\n\t\t}\n\t\tthis.$shouldSaveProps = false;\n\t}\n\n\tprotected $easeProps(stepIndex: number, props: Object, position: number, duration: number, ease: Function): void {\n\t\tif (this.$shouldSaveProps) {\n\t\t\tthis.$saveOriginalProps(stepIndex, props);\n\t\t}\n\t\tlet target = this.$target;\n\t\tlet originalProps = this.$stepProps[stepIndex] || {};\n\t\tif (position > duration) {\n\t\t\tposition = duration;\n\t\t}\n\t\tfor (let key in props) {\n\t\t\tlet originalValue = originalProps[key];\n\t\t\tlet offsetValue = props[key] - originalValue;\n\t\t\ttarget[key] = ease(position, originalValue, offsetValue, duration);\n\t\t}\n\t}\n\n\tprotected $setProps(props: Object): void {\n\t\tlet target = this.$target;\n\t\tfor (let key in props) {\n\t\t\ttarget[key] = props[key];\n\t\t}\n\t}\n\n\tprotected static readonly $tweens: Array<Tween> = [];\n\n\tpublic static get(target: Layer, option?: { loop?: boolean }): Tween {\n\t\treturn new Tween(target, option);\n\t}\n\n\tpublic static pauseTweens(target: Layer): void {\n\t\tlet tweens = this.$tweens;\n\t\tfor (let tween of tweens) {\n\t\t\tif (tween.$target === target) {\n\t\t\t\ttween.pause();\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic static resumeTweens(target: Layer): void {\n\t\tlet tweens = this.$tweens;\n\t\tfor (let tween of tweens) {\n\t\t\tif (tween.$target === target) {\n\t\t\t\ttween.resume();\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic static removeTweens(target: Layer): void {\n\t\tlet tweens = this.$tweens;\n\t\tfor (let i = tweens.length - 1; i >= 0; --i) {\n\t\t\tlet tween = tweens[i];\n\t\t\tif (tween.$target === target) {\n\t\t\t\ttween.stop();\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic static removeAllTweens(): void {\n\t\tlet tweens = this.$tweens;\n\t\tfor (let i = tweens.length - 1; i >= 0; --i) {\n\t\t\tlet tween = tweens[i];\n\t\t\ttween.stop();\n\t\t}\n\t}\n\n}\n\nexport interface TweenStep {\n\ttype: string,\n\tprops?: Object,\n\tduration?: number,\n\tease?: Function,\n\tcallback?: Function\n}\n\nexport interface TweenOption {\n\tloop?: boolean\n}\n","import {Layer} from './Layer';\nimport {Ease} from '../tween/Ease';\nimport {Tween} from '../tween/Tween';\nimport {Matrix} from '../geom/Matrix';\nimport {TouchEvent} from '../event/TouchEvent';\n\nexport class Scroller extends Layer {\n\n\tprotected static scrollingView: Scroller;\n\n\tprotected $scrollTop: number = 0;\n\tprotected $scrollLeft: number = 0;\n\tprotected $scrollWidth: number = 0;\n\tprotected $scrollHeight: number = 0;\n\tprotected $touchingX: number = null;\n\tprotected $touchingY: number = null;\n\tprotected $touchingId: number = null;\n\tprotected $touchingTime: number = null;\n\tprotected $velocitiesX: Array<number> = [];\n\tprotected $velocitiesY: Array<number> = [];\n\tprotected $inertiaTween: Tween = null;\n\n\tpublic constructor() {\n\t\tsuper();\n\t\tthis.width = 200;\n\t\tthis.height = 200;\n\t\tthis.on(TouchEvent.TOUCH_START, this.$onTouchStart);\n\t\tthis.on(TouchEvent.TOUCH_MOVE, this.$onTouchMove);\n\t\tthis.on(TouchEvent.TOUCH_END, this.$onTouchEnd);\n\t\tthis.on(TouchEvent.TOUCH_CANCEL, this.$onTouchCancel);\n\t}\n\n\tpublic get scrollTop(): number {\n\t\treturn this.$scrollTop;\n\t}\n\n\tpublic set scrollTop(scrollTop: number) {\n\t\tlet bounds = this.$getContentBounds();\n\t\tlet maxScrollTop = this.$scrollHeight - this.$height;\n\t\tscrollTop = Math.max(0, Math.min(scrollTop, maxScrollTop));\n\t\tif (scrollTop !== this.$scrollTop) {\n\t\t\tthis.$scrollTop = scrollTop;\n\t\t\tthis.$markDirty();\n\t\t}\n\t\tbounds.release();\n\t}\n\n\tpublic get scrollLeft(): number {\n\t\treturn this.$scrollLeft;\n\t}\n\n\tpublic set scrollLeft(scrollLeft: number) {\n\t\tlet bounds = this.$getContentBounds();\n\t\tlet maxScrollLeft = this.$scrollWidth - this.width;\n\t\tscrollLeft = Math.max(0, Math.min(scrollLeft, maxScrollLeft));\n\t\tif (scrollLeft !== this.$scrollLeft) {\n\t\t\tthis.$scrollLeft = scrollLeft;\n\t\t\tthis.$markDirty();\n\t\t}\n\t\tbounds.release();\n\t}\n\n\tpublic get scrollWidth(): number {\n\t\treturn this.$scrollWidth;\n\t}\n\n\tpublic get scrollHeight(): number {\n\t\treturn this.$scrollHeight;\n\t}\n\n\tprotected $getChildTransform(child: Layer): Matrix {\n\t\tlet matrix = super.$getChildTransform(child);\n\t\tmatrix.translate(-this.$scrollLeft, -this.$scrollTop);\n\t\treturn matrix;\n\t}\n\n\tprotected $resizeCanvas(): void {\n\t\tsuper.$resizeCanvas();\n\t\tlet bounds = this.$getContentBounds();\n\t\tthis.$scrollWidth = this.$scrollLeft + bounds.right + this.$anchorX;\n\t\tthis.$scrollHeight = this.$scrollTop + bounds.bottom + this.$anchorY;\n\t\tthis.scrollTop = this.$scrollTop;\n\t\tthis.scrollLeft = this.$scrollLeft;\n\t}\n\n\tprotected $onTouchStart(e: TouchEvent): void {\n\t\tthis.$touchingX = e.localX;\n\t\tthis.$touchingY = e.localY;\n\t\tthis.$velocitiesX.length = 0;\n\t\tthis.$velocitiesY.length = 0;\n\t\tthis.$touchingTime = Date.now();\n\t\tthis.$touchingId = e.identifier;\n\t\tif (this.$inertiaTween) {\n\t\t\tthis.$inertiaTween.pause();\n\t\t\tthis.$inertiaTween = null;\n\t\t}\n\t}\n\n\tprotected $onTouchMove(e: TouchEvent): void {\n\t\tif (e.identifier !== this.$touchingId) {\n\t\t\treturn;\n\t\t}\n\t\tlet now = Date.now();\n\t\tlet scrollTop = this.scrollTop;\n\t\tlet scrollLeft = this.scrollLeft;\n\t\tlet dt = now - this.$touchingTime;\n\t\tlet velocitiesX = this.$velocitiesX;\n\t\tlet velocitiesY = this.$velocitiesY;\n\t\tlet offsetX = e.localX - this.$touchingX;\n\t\tlet offsetY = e.localY - this.$touchingY;\n\t\tlet scrollingView = Scroller.scrollingView || this;\n\t\tvelocitiesX.push(offsetX / dt);\n\t\tvelocitiesY.push(offsetY / dt);\n\t\tif (velocitiesX.length > 5) {\n\t\t\tvelocitiesX.shift();\n\t\t\tvelocitiesY.shift();\n\t\t}\n\t\tthis.$touchingX = e.localX;\n\t\tthis.$touchingY = e.localY;\n\t\tif (scrollingView === this) {\n\t\t\tthis.$touchingTime = now;\n\t\t\tthis.scrollTop -= offsetY;\n\t\t\tthis.scrollLeft -= offsetX;\n\t\t\tif (this.$scrollLeft !== scrollLeft || this.$scrollTop !== scrollTop) {\n\t\t\t\tScroller.scrollingView = this;\n\t\t\t}\n\t\t}\n\t}\n\n\tprotected $onTouchEnd(e: TouchEvent): void {\n\t\tif (e.identifier !== this.$touchingId) {\n\t\t\treturn;\n\t\t}\n\t\tif (Scroller.scrollingView === this) {\n\t\t\tScroller.scrollingView = null;\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\t\tlet sumVelocityX = 0;\n\t\tlet sumVelocityY = 0;\n\t\tlet scrollTop = this.$scrollTop;\n\t\tlet scrollLeft = this.$scrollLeft;\n\t\tlet velocitiesX = this.$velocitiesX;\n\t\tlet velocitiesY = this.$velocitiesY;\n\t\tlet numVelocities = velocitiesX.length;\n\t\tfor (let i = 0; i < numVelocities; ++i) {\n\t\t\tsumVelocityX += velocitiesX[i];\n\t\t\tsumVelocityY += velocitiesY[i];\n\t\t}\n\t\tlet velocityX = sumVelocityX / numVelocities;\n\t\tlet velocityY = sumVelocityY / numVelocities;\n\t\tlet absVelocityX = Math.abs(velocityX);\n\t\tlet absVelocityY = Math.abs(velocityY);\n\t\tif (absVelocityX > 0.01 || absVelocityY > 0.01) {\n\t\t\tlet duration = Math.max(absVelocityX, absVelocityY, 1) * 1000;\n\t\t\tthis.$inertiaTween = Tween.get(this).to({\n\t\t\t\tscrollTop: scrollTop - velocityY * (absVelocityY + 1) * 200,\n\t\t\t\tscrollLeft: scrollLeft - velocityX * (absVelocityX + 1) * 200\n\t\t\t}, duration, Ease.easeOutQuart).play();\n\t\t}\n\t\tthis.$touchingId = null;\n\t}\n\n\tprotected $onTouchCancel(e: TouchEvent): void {\n\t\tif (e.identifier === this.$touchingId) {\n\t\t\tthis.$touchingId = null;\n\t\t}\n\t}\n\n\tprotected $emitRemovedFromStage(): void {\n\t\tsuper.$emitRemovedFromStage();\n\t\tif (this.$inertiaTween) {\n\t\t\tthis.$inertiaTween.pause();\n\t\t\tthis.$inertiaTween = null;\n\t\t}\n\t}\n\n}\n","import {Layer} from './Layer';\nimport {Event} from '../event/Event';\nimport {Texture} from '../media/Texture';\nimport {Rectangle} from '../geom/Rectangle';\n\nexport class Image extends Layer {\n\n\tpublic static SCALE: FillMode = 'scale';\n\tpublic static REPEAT: FillMode = 'repeat';\n\tpublic static REPEAT_X: FillMode = 'repeat-x';\n\tpublic static REPEAT_Y: FillMode = 'repeat-y';\n\n\tprotected $texture: Texture = null;\n\tprotected $fillMode: FillMode = Image.SCALE;\n\tprotected $clipRect: Rectangle = null;\n\tprotected $scale9Grid: Rectangle = null;\n\tprotected $pattern: CanvasPattern = null;\n\tprotected readonly $boundOnTextureLoad: () => void;\n\n\tpublic constructor(texture?: Texture);\n\tpublic constructor(texture: Texture, width: number, height: number);\n\tpublic constructor(texture?: Texture, width?: number, height?: number) {\n\t\tsuper();\n\t\tthis.$boundOnTextureLoad = this.$onTextureLoad.bind(this);\n\t\tif (texture) {\n\t\t\tthis.$width = width;\n\t\t\tthis.$height = height;\n\t\t\tthis.texture = texture;\n\t\t}\n\t}\n\n\tpublic get texture(): Texture {\n\t\treturn this.$texture;\n\t}\n\n\tpublic set texture(texture: Texture) {\n\t\tif (this.$texture) {\n\t\t\tthis.$texture.off(Event.LOAD, this.$boundOnTextureLoad);\n\t\t}\n\t\tthis.$texture = texture;\n\t\tif (texture) {\n\t\t\ttexture.on(Event.LOAD, this.$boundOnTextureLoad);\n\t\t} else {\n\t\t\tthis.$updatePattern();\n\t\t\tthis.$resizeCanvas();\n\t\t}\n\t}\n\n\tpublic get fillMode(): FillMode {\n\t\treturn this.$fillMode;\n\t}\n\n\tpublic set fillMode(fillMode: FillMode) {\n\t\tthis.$fillMode = fillMode;\n\t\tthis.$updatePattern();\n\t\tthis.$markDirty();\n\t}\n\n\tpublic get clipRect(): Rectangle {\n\t\treturn this.$clipRect;\n\t}\n\n\tpublic set clipRect(clipRect: Rectangle) {\n\t\tthis.$clipRect = clipRect;\n\t\tthis.$markDirty();\n\t}\n\n\tpublic get scale9Grid(): Rectangle {\n\t\treturn this.$scale9Grid;\n\t}\n\n\tpublic set scale9Grid(scale9Grid: Rectangle) {\n\t\tthis.$scale9Grid = scale9Grid;\n\t\tthis.$markDirty();\n\t}\n\n\tprotected $onTextureLoad(): void {\n\t\tthis.$updatePattern();\n\t\tthis.$resizeCanvas();\n\t\tthis.$texture.off(Event.LOAD, this.$boundOnTextureLoad);\n\t}\n\n\tprotected $updatePattern(): void {\n\t\tlet width = this.$width;\n\t\tlet height = this.$height;\n\t\tlet texture = this.$texture;\n\t\tlet fillMode = this.$fillMode;\n\t\tif ((width || height) && texture && fillMode && fillMode !== Image.SCALE) {\n\t\t\tthis.$pattern = this.$context.createPattern(texture.element, fillMode);\n\t\t} else {\n\t\t\tthis.$pattern = null;\n\t\t}\n\t}\n\n\tprotected $getContentBounds(): Rectangle {\n\t\tlet texture = this.$texture;\n\t\tlet clipRect = this.$clipRect;\n\t\tlet bounds = super.$getContentBounds();\n\t\tbounds.x = Math.min(bounds.left, -this.$anchorX);\n\t\tbounds.y = Math.min(bounds.top, -this.$anchorY);\n\t\tif (clipRect) {\n\t\t\tbounds.width = Math.max(bounds.width, clipRect.width);\n\t\t\tbounds.height = Math.max(bounds.height, clipRect.height);\n\t\t} else if (texture) {\n\t\t\tbounds.width = Math.max(bounds.width, texture.width);\n\t\t\tbounds.height = Math.max(bounds.height, texture.height);\n\t\t}\n\t\treturn bounds;\n\t}\n\n\tprotected $drawPattern(targetX, targetY, targetW, targetH): void {\n\t\tlet ctx = this.$context;\n\t\tlet texture = this.$texture;\n\t\tlet pattern = this.$pattern;\n\t\tlet scale = Layer.pixelRatio / texture.pixelRatio;\n\t\tscale !== 1 && ctx.scale(scale, scale);\n\t\tctx.fillStyle = pattern;\n\t\tctx.fillRect(targetX, targetY, targetW, targetH);\n\t}\n\n\tprotected $drawTexture(sourceX: number, sourceY: number, sourceW: number, sourceH: number, targetX: number, targetY: number, targetW: number, targetH: number): void {\n\t\tif (sourceW <= 0 || sourceH <= 0 || targetW <= 0 || targetH <= 0) {\n\t\t\treturn;\n\t\t}\n\t\tlet ctx = this.$context;\n\t\tlet texture = this.$texture;\n\t\tlet pixelRatio = texture.pixelRatio;\n\t\tif (sourceW > 0 && sourceH > 0 && targetW > 0 && targetH > 0) {\n\t\t\tctx.drawImage(texture.element, sourceX * pixelRatio, sourceY * pixelRatio, sourceW * pixelRatio, sourceH * pixelRatio, targetX, targetY, targetW, targetH);\n\t\t}\n\t}\n\n\tprotected $render(): number {\n\t\tif (!this.$dirty) {\n\t\t\treturn 0;\n\t\t}\n\t\tlet canvas = this.$canvas;\n\t\tlet anchorX = this.$anchorX;\n\t\tlet anchorY = this.$anchorY;\n\t\tlet texture = this.$texture;\n\t\tlet pattern = this.$pattern;\n\t\tlet clipRect = this.$clipRect;\n\t\tlet scale9Grid = this.$scale9Grid;\n\t\tlet drawCalls = super.$render();\n\t\tlet pixelRatio = Layer.pixelRatio;\n\t\tlet x = -anchorX * pixelRatio;\n\t\tlet y = -anchorY * pixelRatio;\n\t\tlet width = canvas.width;\n\t\tlet height = canvas.height;\n\t\tlet clipX = clipRect ? clipRect.x : 0;\n\t\tlet clipY = clipRect ? clipRect.y : 0;\n\t\tlet clipWidth = clipRect ? clipRect.width : texture ? texture.width : 0;\n\t\tlet clipHeight = clipRect ? clipRect.height : texture ? texture.height : 0;\n\t\tif (!texture) {\n\t\t\treturn drawCalls;\n\t\t} else if (pattern) {\n\t\t\tthis.$drawPattern(x, y, width, height);\n\t\t} else if (scale9Grid) {\n\t\t\tlet sourceX0 = clipX;\n\t\t\tlet sourceY0 = clipY;\n\t\t\tlet sourceW0 = scale9Grid.x;\n\t\t\tlet sourceH0 = scale9Grid.y;\n\t\t\tlet sourceX1 = sourceX0 + sourceW0;\n\t\t\tlet sourceY1 = sourceY0 + sourceH0;\n\t\t\tlet sourceW1 = scale9Grid.width;\n\t\t\tlet sourceH1 = scale9Grid.height;\n\t\t\tlet sourceX2 = sourceX1 + sourceW1;\n\t\t\tlet sourceY2 = sourceY1 + sourceH1;\n\t\t\tlet sourceW2 = clipWidth - sourceW0 - sourceW1;\n\t\t\tlet sourceH2 = clipHeight - sourceH0 - sourceH1;\n\t\t\tlet targetX0 = -anchorX * pixelRatio;\n\t\t\tlet targetY0 = -anchorY * pixelRatio;\n\t\t\tlet targetW0 = sourceW0 * pixelRatio;\n\t\t\tlet targetH0 = sourceH0 * pixelRatio;\n\t\t\tlet targetX1 = targetX0 + targetW0;\n\t\t\tlet targetY1 = targetY0 + targetH0;\n\t\t\tlet targetW1 = width - (sourceW0 + sourceW2) * pixelRatio;\n\t\t\tlet targetH1 = height - (sourceH0 + sourceH2) * pixelRatio;\n\t\t\tlet targetX2 = targetX1 + targetW1;\n\t\t\tlet targetY2 = targetY1 + targetH1;\n\t\t\tlet targetW2 = width - targetW0 - targetW1;\n\t\t\tlet targetH2 = height - targetH0 - targetH1;\n\t\t\tthis.$drawTexture(sourceX0, sourceY0, sourceW0, sourceH0, targetX0, targetY0, targetW0, targetH0);\n\t\t\tthis.$drawTexture(sourceX1, sourceY0, sourceW1, sourceH0, targetX1, targetY0, targetW1, targetH0);\n\t\t\tthis.$drawTexture(sourceX2, sourceY0, sourceW2, sourceH0, targetX2, targetY0, targetW2, targetH0);\n\t\t\tthis.$drawTexture(sourceX0, sourceY1, sourceW0, sourceH1, targetX0, targetY1, targetW0, targetH1);\n\t\t\tthis.$drawTexture(sourceX1, sourceY1, sourceW1, sourceH1, targetX1, targetY1, targetW1, targetH1);\n\t\t\tthis.$drawTexture(sourceX2, sourceY1, sourceW2, sourceH1, targetX2, targetY1, targetW2, targetH1);\n\t\t\tthis.$drawTexture(sourceX0, sourceY2, sourceW0, sourceH2, targetX0, targetY2, targetW0, targetH2);\n\t\t\tthis.$drawTexture(sourceX1, sourceY2, sourceW1, sourceH2, targetX1, targetY2, targetW1, targetH2);\n\t\t\tthis.$drawTexture(sourceX2, sourceY2, sourceW2, sourceH2, targetX2, targetY2, targetW2, targetH2);\n\t\t} else {\n\t\t\tthis.$drawTexture(clipX, clipY, clipWidth, clipHeight, x, y, width, height);\n\t\t}\n\t\treturn drawCalls;\n\t}\n\n}\n\nexport type FillMode = 'scale' | 'repeat' | 'repeat-x' | 'repeat-y';\n","import {Layer} from './Layer';\nimport {Rectangle} from '../geom/Rectangle';\n\nexport class Text extends Layer {\n\n\tpublic static defaultFontSize: number = 16;\n\n\tprotected static readonly wordRe: RegExp = /\\w+/;\n\tprotected static readonly boundaryRe: RegExp = /\\b/;\n\n\tprotected $text: string = '';\n\tprotected $color: string = 'black';\n\tprotected $fontSize: number = Text.defaultFontSize;\n\tprotected $fontStyle: FontStyle = 'normal';\n\tprotected $fontWeight: FontWeight = 'normal';\n\tprotected $textAlign: TextAlign = 'left';\n\tprotected $verticalAlign: VerticalAlign = 'top';\n\tprotected $lineHeight: number = 1.2;\n\tprotected $strokeSize: number = 0;\n\tprotected $strokeColor: string = null;\n\tprotected $fontFamily: string = 'Helvetica';\n\tprotected $multiline: boolean = false;\n\tprotected $breakWord: boolean = false;\n\tprotected $autoFitSize: boolean = false;\n\tprotected $minFontSize: number = 0;\n\tprotected $explicitSize: number = 0;\n\tprotected $lines: Array<string> = [];\n\n\tpublic constructor(text?: string, options: TextOption = {}) {\n\t\tsuper();\n\t\tthis.$text = text || this.$text;\n\t\tthis.$color = options.color || this.$color;\n\t\tthis.$fontSize = options.fontSize || this.$fontSize;\n\t\tthis.$fontStyle = options.fontStyle || this.$fontStyle;\n\t\tthis.$fontWeight = options.fontWeight || this.$fontWeight;\n\t\tthis.$textAlign = options.textAlign || this.$textAlign;\n\t\tthis.$verticalAlign = options.verticalAlign || this.$verticalAlign;\n\t\tthis.$lineHeight = options.lineHeight || this.$lineHeight;\n\t\tthis.$strokeSize = options.strokeSize || this.$strokeSize;\n\t\tthis.$strokeColor = options.strokeColor || this.$strokeColor;\n\t\tthis.$fontFamily = options.fontFamily || this.$fontFamily;\n\t\tthis.$multiline = options.multiline || this.$multiline;\n\t\tthis.$breakWord = options.breakWord || this.$breakWord;\n\t\tthis.$autoFitSize = options.autoFitSize || this.autoFitSize;\n\t\tthis.$minFontSize = options.minFontSize || this.minFontSize;\n\t\tthis.$resizeCanvas();\n\t}\n\n\tpublic get text(): string {\n\t\treturn this.$text;\n\t}\n\n\tpublic set text(text: string) {\n\t\tthis.$text = text;\n\t\tthis.$resizeCanvas();\n\t}\n\n\tpublic get color(): string {\n\t\treturn this.$color;\n\t}\n\n\tpublic set color(color: string) {\n\t\tthis.$color = color;\n\t\tthis.$markDirty();\n\t}\n\n\tpublic get fontSize(): number {\n\t\treturn this.$fontSize;\n\t}\n\n\tpublic set fontSize(fontSize: number) {\n\t\tthis.$fontSize = fontSize;\n\t\tthis.$resizeCanvas();\n\t}\n\n\tpublic get fontStyle(): FontStyle {\n\t\treturn this.$fontStyle;\n\t}\n\n\tpublic set fontStyle(fontStyle: FontStyle) {\n\t\tthis.$fontStyle = fontStyle;\n\t\tthis.$resizeCanvas();\n\t}\n\n\tpublic get fontWeight(): FontWeight {\n\t\treturn this.$fontWeight;\n\t}\n\n\tpublic set fontWeight(fontWeight: FontWeight) {\n\t\tthis.$fontWeight = fontWeight;\n\t\tthis.$resizeCanvas();\n\t}\n\n\tpublic get textAlign(): TextAlign {\n\t\treturn this.$textAlign;\n\t}\n\n\tpublic set textAlign(textAlign: TextAlign) {\n\t\tthis.$textAlign = textAlign;\n\t\tthis.$markDirty();\n\t}\n\n\tpublic get verticalAlign(): VerticalAlign {\n\t\treturn this.$verticalAlign;\n\t}\n\n\tpublic set verticalAlign(verticalAlign: VerticalAlign) {\n\t\tthis.$verticalAlign = verticalAlign;\n\t\tthis.$markDirty();\n\t}\n\n\tpublic get lineHeight(): number {\n\t\treturn this.$lineHeight;\n\t}\n\n\tpublic set lineHeight(lineHeight: number) {\n\t\tthis.$lineHeight = lineHeight;\n\t\tthis.$resizeCanvas();\n\t}\n\n\tpublic get strokeSize(): number {\n\t\treturn this.$strokeSize;\n\t}\n\n\tpublic set strokeSize(strokeSize: number) {\n\t\tthis.$strokeSize = strokeSize;\n\t\tthis.$markDirty();\n\t}\n\n\tpublic get strokeColor(): string {\n\t\treturn this.$strokeColor;\n\t}\n\n\tpublic set strokeColor(strokeColor: string) {\n\t\tthis.$strokeColor = strokeColor;\n\t\tthis.$markDirty();\n\t}\n\n\tpublic get fontFamily(): string {\n\t\treturn this.$fontFamily;\n\t}\n\n\tpublic set fontFamily(fontFamily: string) {\n\t\tthis.$fontFamily = fontFamily;\n\t\tthis.$resizeCanvas();\n\t}\n\n\tpublic get multiline(): boolean {\n\t\treturn this.$multiline;\n\t}\n\n\tpublic set multiline(multiline: boolean) {\n\t\tthis.$multiline = multiline;\n\t\tthis.$resizeCanvas();\n\t}\n\n\tpublic get breakWord(): boolean {\n\t\treturn this.$breakWord;\n\t}\n\n\tpublic set breakWord(breakWord: boolean) {\n\t\tthis.$breakWord = breakWord;\n\t\tthis.$resizeCanvas();\n\t}\n\n\tpublic get autoFitSize(): boolean {\n\t\treturn this.$autoFitSize;\n\t}\n\n\tpublic set autoFitSize(autoFitSize: boolean) {\n\t\tthis.$autoFitSize = autoFitSize;\n\t\tthis.$resizeCanvas();\n\t}\n\n\tpublic get minFontSize(): number {\n\t\treturn this.$minFontSize;\n\t}\n\n\tpublic set minFontSize(minFontSize: number) {\n\t\tthis.$minFontSize = minFontSize;\n\t\tthis.$resizeCanvas();\n\t}\n\n\tprotected $updateContext(): void {\n\t\tlet ctx = this.$context;\n\t\tlet fontStyle = this.$fontStyle;\n\t\tlet fontWeight = this.$fontWeight;\n\t\tlet pixelRatio = Layer.pixelRatio;\n\t\tlet fontSize = this.$explicitSize || this.$fontSize;\n\t\tlet sizeStr = fontSize * pixelRatio + 'px';\n\t\tctx.font = fontStyle + ' ' + fontWeight + ' ' + sizeStr + ' ' + this.$fontFamily;\n\t\tctx.textAlign = this.$textAlign;\n\t\tctx.textBaseline = 'top';\n\t\tctx.fillStyle = this.$color;\n\t\tctx.lineWidth = this.$strokeSize * pixelRatio;\n\t\tctx.strokeStyle = this.$strokeColor;\n\t}\n\n\tprotected $divideUnits(): Array<string> {\n\t\tlet units;\n\t\tlet text = this.$text;\n\t\tlet breakWord = this.$breakWord;\n\t\tlet wordRe = Text.wordRe;\n\t\tlet boundaryRe = Text.boundaryRe;\n\t\tif (breakWord) {\n\t\t\tunits = text.split('');\n\t\t} else {\n\t\t\tlet words = text.split(boundaryRe);\n\t\t\tunits = [];\n\t\t\tfor (let unit of words) {\n\t\t\t\tif (wordRe.test(unit)) {\n\t\t\t\t\tunits.push(unit);\n\t\t\t\t} else {\n\t\t\t\t\tunits = units.concat(unit.split(''));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn units;\n\t}\n\n\tprotected $divideLines(): void {\n\t\tlet text = this.$text;\n\t\tif (!this.$multiline) {\n\t\t\tthis.$lines = [text];\n\t\t\treturn;\n\t\t} else if (!this.$width) {\n\t\t\tthis.$lines = text.split('\\n');\n\t\t\treturn;\n\t\t}\n\t\tlet line = '';\n\t\tlet ctx = this.$context;\n\t\tlet lines = this.$lines = [];\n\t\tlet units = this.$divideUnits();\n\t\tlet width = this.$width * Layer.pixelRatio;\n\t\tthis.$updateContext();\n\t\tfor (let unit of units) {\n\t\t\tif (unit === '\\n') {\n\t\t\t\tlines.push(line);\n\t\t\t\tline = '';\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlet lineWidth = ctx.measureText(line + unit).width;\n\t\t\tif (lineWidth <= width) {\n\t\t\t\tline += unit;\n\t\t\t} else {\n\t\t\t\tline && lines.push(line);\n\t\t\t\tline = unit;\n\t\t\t}\n\t\t}\n\t\tlines.push(line);\n\t}\n\n\tprotected $resizeCanvas(): void {\n\t\tlet width = this.$width;\n\t\tlet height = this.$height;\n\t\tthis.$divideLines();\n\t\tif (this.$autoFitSize && (width || height)) {\n\t\t\tlet minFontSize = this.$minFontSize || 1;\n\t\t\tthis.$explicitSize = this.$fontSize;\n\t\t\twhile (this.$explicitSize > minFontSize) {\n\t\t\t\tlet bounds = this.$getContentBounds();\n\t\t\t\tif ((width && bounds.width > width) || (height && bounds.height > height)) {\n\t\t\t\t\t--this.$explicitSize;\n\t\t\t\t} else {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tbounds.release();\n\t\t\t}\n\t\t}\n\t\tsuper.$resizeCanvas();\n\t}\n\n\tprotected $getContentBounds(): Rectangle {\n\t\tlet ctx = this.$context;\n\t\tlet bounds = super.$getContentBounds();\n\t\tlet lines = this.$lines;\n\t\tlet lineHeight = this.$lineHeight;\n\t\tlet pixelRatio = Layer.pixelRatio;\n\t\tlet fontSize = this.$explicitSize || this.$fontSize;\n\t\tthis.$updateContext();\n\t\tfor (let line of lines) {\n\t\t\tbounds.width = Math.max(bounds.width, ctx.measureText(line).width / pixelRatio);\n\t\t}\n\t\tbounds.height = Math.max(bounds.height, fontSize * lineHeight * lines.length);\n\t\treturn bounds;\n\t}\n\n\tprotected $render(): number {\n\t\tif (!this.$dirty) {\n\t\t\treturn 0;\n\t\t}\n\t\tlet x = 0;\n\t\tlet y = 0;\n\t\tlet width = this.width;\n\t\tlet height = this.height;\n\t\tlet anchorX = this.anchorX;\n\t\tlet anchorY = this.anchorY;\n\t\tlet ctx = this.$context;\n\t\tlet lines = this.$lines;\n\t\tlet color = this.$color;\n\t\tlet textAlign = this.$textAlign;\n\t\tlet verticalAlign = this.$verticalAlign;\n\t\tlet lineHeight = this.$lineHeight;\n\t\tlet strokeSize = this.$strokeSize;\n\t\tlet strokeColor = this.$strokeColor;\n\t\tlet pixelRatio = Layer.pixelRatio;\n\t\tlet fontSize = this.$explicitSize || this.$fontSize;\n\t\tlet drawCalls = super.$render();\n\t\tthis.$updateContext();\n\t\tif (textAlign === 'center') {\n\t\t\tx = width * pixelRatio / 2 - anchorX * pixelRatio;\n\t\t} else if (textAlign === 'right') {\n\t\t\tx = width * pixelRatio - anchorX * pixelRatio;\n\t\t} else {\n\t\t\tx = -anchorX * pixelRatio;\n\t\t}\n\t\tif (verticalAlign === 'middle') {\n\t\t\ty = (height - fontSize * lineHeight * (lines.length - 1) - fontSize) * pixelRatio / 2 - anchorY * pixelRatio;\n\t\t} else if (verticalAlign === 'bottom') {\n\t\t\ty = (height - fontSize * lineHeight * (lines.length - 1) - fontSize) * pixelRatio - anchorY * pixelRatio;\n\t\t} else {\n\t\t\ty = -anchorY * pixelRatio;\n\t\t}\n\t\tfor (let line of lines) {\n\t\t\tif (color) {\n\t\t\t\tctx.fillText(line, x, y);\n\t\t\t}\n\t\t\tif (strokeSize && strokeColor) {\n\t\t\t\tctx.strokeText(line, x, y);\n\t\t\t}\n\t\t\ty += fontSize * lineHeight * pixelRatio;\n\t\t}\n\t\treturn drawCalls;\n\t}\n\n}\n\nexport type FontStyle = 'normal' | 'italic' | 'oblique';\nexport type FontWeight = 'normal' | 'bold' | 'bolder' | 'lighter' | 100 | 200 | 300 | 400 | 500 | 600 | 700 | 800 | 900;\nexport type TextAlign = 'left' | 'right' | 'center';\nexport type VerticalAlign = 'top' | 'middle' | 'bottom';\n\nexport interface TextOption {\n\tcolor?: string;\n\tfontSize?: number;\n\tfontWeight?: FontWeight;\n\tfontStyle?: FontStyle;\n\ttextAlign?: TextAlign;\n\tverticalAlign?: VerticalAlign;\n\tlineHeight?: number;\n\tstrokeSize?: number;\n\tstrokeColor?: string;\n\tfontFamily?: string;\n\tmultiline?: boolean;\n\tbreakWord?: boolean;\n\tautoFitSize?: boolean;\n\tminFontSize?: number;\n}\n","import {Text, TextOption} from './Text';\nimport {TouchEvent} from '../event/TouchEvent';\n\nexport class Input extends Text {\n\n\tprotected static $focusedInput: Input;\n\tprotected static $inputElement: HTMLInputElement;\n\tprotected static $textAreaElement: HTMLTextAreaElement;\n\n\tprotected $value: string = '';\n\tprotected $type: InputType = 'text';\n\tprotected $maxLength: number = 0xffffff;\n\tprotected $placeholder: string = '';\n\tprotected $placeholderColor: string = '#888';\n\tprotected $explicitColor: string = 'black';\n\tprotected $boundFocus: () => void;\n\n\tpublic constructor(value?: string, options: InputOption = {}) {\n\t\tsuper('', options);\n\t\tthis.$value = value || this.$value;\n\t\tthis.$type = options.type || this.$type;\n\t\tthis.$maxLength = options.maxLength || this.$maxLength;\n\t\tthis.$placeholder = options.placeholder || this.$placeholder;\n\t\tthis.$placeholderColor = options.placeholderColor || this.$placeholderColor;\n\t\tthis.$boundFocus = this.focus.bind(this);\n\t\tthis.$updateText();\n\t\tthis.on(TouchEvent.TOUCH_TAP, this.$onTouchTap);\n\t}\n\n\tpublic set text(text: string) {\n\t}\n\n\tpublic get value(): string {\n\t\treturn this.$value;\n\t}\n\n\tpublic set value(value: string) {\n\t\tthis.$value = value;\n\t\tthis.$updateText();\n\t}\n\n\tpublic get type(): InputType {\n\t\treturn this.$type;\n\t}\n\n\tpublic set type(type: InputType) {\n\t\tthis.$type = type;\n\t\tthis.$updateText();\n\t}\n\n\tpublic get color(): string {\n\t\treturn this.$explicitColor;\n\t}\n\n\tpublic set color(color: string) {\n\t\tthis.$explicitColor = color;\n\t\tif (this.$value) {\n\t\t\tthis.$color = color;\n\t\t} else {\n\t\t\tthis.$color = this.$placeholderColor;\n\t\t}\n\t\tthis.$markDirty();\n\t}\n\n\tpublic get maxLength(): number {\n\t\treturn this.$maxLength;\n\t}\n\n\tpublic set maxLength(maxLength: number) {\n\t\tthis.$maxLength = maxLength;\n\t}\n\n\tpublic get placeholder(): string {\n\t\treturn this.$placeholder;\n\t}\n\n\tpublic set placeholder(placeholder: string) {\n\t\tthis.$placeholder = placeholder;\n\t\tthis.$updateText();\n\t}\n\n\tpublic get placeholderColor(): string {\n\t\treturn this.$placeholderColor;\n\t}\n\n\tpublic set placeholderColor(placeholderColor: string) {\n\t\tthis.$placeholderColor = placeholderColor;\n\t\tthis.$markDirty();\n\t}\n\n\tpublic selectAll(): this {\n\t\tlet element = this.$updateElement();\n\t\tthis.focus();\n\t\telement.selectionStart = 0;\n\t\telement.selectionEnd = this.$value.length;\n\t\treturn this;\n\t}\n\n\tpublic focus(): this {\n\t\tlet element = this.$updateElement();\n\t\telement.style.display = 'block';\n\t\telement.value = this.$value;\n\t\telement.focus();\n\t\tInput.$focusedInput = this;\n\t\treturn this;\n\t}\n\n\tpublic blur(): this {\n\t\tlet element = this.$updateElement();\n\t\telement.style.display = 'none';\n\t\telement.blur();\n\t\tif (Input.$focusedInput === this) {\n\t\t\tthis.value = element.value;\n\t\t\tInput.$focusedInput = null;\n\t\t}\n\t\treturn this;\n\t}\n\n\tprotected $updateText(): void {\n\t\tlet text;\n\t\tlet type = this.$type;\n\t\tlet value = this.$value;\n\t\tif (type === 'password') {\n\t\t\ttext = '';\n\t\t\tfor (let i = 0, l = value.length; i < l; ++i) {\n\t\t\t\ttext += '';\n\t\t\t}\n\t\t} else {\n\t\t\ttext = value;\n\t\t}\n\t\tif (text) {\n\t\t\tthis.$text = text;\n\t\t} else {\n\t\t\tthis.$text = this.$placeholder;\n\t\t}\n\t\tthis.color = this.$explicitColor;\n\t\tthis.$resizeCanvas();\n\t}\n\n\tprotected $updateElement(): HTMLInputElement | HTMLTextAreaElement {\n\t\tlet tagName = this.$multiline && this.$type === 'text' ? 'textarea' : 'input';\n\t\tlet element = Input.$getElement(tagName);\n\t\tlet isInput = tagName === 'input';\n\t\tif (isInput) {\n\t\t\t// @ts-ignore\n\t\t\telement.type = this.$type;\n\t\t}\n\t\telement.maxLength = this.$maxLength;\n\t\telement.placeholder = this.$placeholder;\n\t\telement.style.left = '0';\n\t\telement.style.bottom = '0';\n\t\telement.style.margin = '0';\n\t\telement.style.width = '100%';\n\t\telement.style.height = (isInput ? this.$fontSize * this.$lineHeight + 24 : this.height) + 'px';\n\t\telement.style.minHeight = isInput ? '0' : (this.$fontSize * this.$lineHeight) * 5 + 12 + 'px';\n\t\telement.style.maxHeight = '50%';\n\t\telement.style.padding = '6px';\n\t\telement.style.border = 'none';\n\t\telement.style.resize = 'none';\n\t\telement.style.outline = 'none';\n\t\telement.style.position = 'fixed';\n\t\telement.style.boxSizing = 'border-box';\n\t\telement.style.color = this.$explicitColor;\n\t\telement.style.fontSize = this.$fontSize + 'px';\n\t\telement.style.fontStyle = this.$fontStyle;\n\t\telement.style.fontFamily = this.$fontFamily;\n\t\telement.style.textAlign = this.$textAlign;\n\t\telement.style.lineHeight = this.$lineHeight + '';\n\t\telement.style.fontWeight = this.$fontWeight + '';\n\t\telement.style.wordBreak = this.$breakWord ? 'break-all' : 'normal';\n\t\telement.style.background = this.$background;\n\t\t// element.style.webkitTapHighlightColor = 'transparent';\n\t\telement.style.boxShadow = '0 0 8px #aaa';\n\t\treturn element;\n\t}\n\n\tprotected $markDirty(sizeDirty?: boolean): void {\n\t\tsuper.$markDirty(sizeDirty);\n\t\tif (Input.$focusedInput) {\n\t\t\tthis.$updateElement();\n\t\t}\n\t}\n\n\tprotected $onTouchTap(): void {\n\t\tsetTimeout(this.$boundFocus, 100);\n\t}\n\n\tprotected static $getElement(tagName: string): HTMLInputElement | HTMLTextAreaElement {\n\t\tlet element;\n\t\tif (tagName === 'input') {\n\t\t\telement = this.$inputElement;\n\t\t} else if (tagName === 'textarea') {\n\t\t\telement = this.$textAreaElement;\n\t\t}\n\t\tif (!element) {\n\t\t\telement = document.createElement(tagName);\n\t\t\telement.style.display = 'none';\n\t\t\tdocument.body.appendChild(element);\n\t\t\telement.addEventListener('input', () => {\n\t\t\t\tInput.$focusedInput.value = element.value;\n\t\t\t});\n\t\t\telement.addEventListener('blur', () => {\n\t\t\t\tInput.$focusedInput.blur();\n\t\t\t});\n\t\t\tif (tagName === 'input') {\n\t\t\t\telement.addEventListener('keydown', e => {\n\t\t\t\t\tif (e.key === 'Enter' || e.keyCode === 13) {\n\t\t\t\t\t\tInput.$focusedInput.blur();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.$inputElement = element;\n\t\t\t} else if (tagName === 'textarea') {\n\t\t\t\tthis.$textAreaElement = element;\n\t\t\t}\n\t\t}\n\t\treturn element;\n\t}\n\n}\n\nexport type InputType =\n\t'text' |\n\t'password' |\n\t'email' |\n\t'url' |\n\t'number' |\n\t'range' |\n\t'tel' |\n\t'date' |\n\t'month' |\n\t'week' |\n\t'time' |\n\t'datetime' |\n\t'datetime-local';\n\nexport interface InputOption extends TextOption {\n\ttype?: InputType,\n\tmaxLength?: number,\n\tplaceholder?: string,\n\tplaceholderColor?: string\n}\n","import {Image} from './Image';\nimport {Event} from '../event/Event';\nimport {Texture} from '../media/Texture';\nimport {Rectangle} from '../geom/Rectangle';\n\nexport class MovieClip extends Image {\n\n\tprotected $loop: boolean = true;\n\tprotected $interval: number = 30;\n\tprotected $paused: boolean = false;\n\tprotected $currentFrame: number = 0;\n\tprotected $frames: Array<MovieClipFrame> = null;\n\tprotected $timer: number;\n\tprotected $boundNextFrame: Function;\n\n\tpublic constructor(texture: Texture, frames: Array<MovieClipFrame>) {\n\t\tsuper(texture);\n\t\tthis.$frames = frames;\n\t\tthis.$boundNextFrame = this.nextFrame.bind(this);\n\t\tthis.play();\n\t}\n\n\tpublic get loop(): boolean {\n\t\treturn this.$loop;\n\t}\n\n\tpublic set loop(loop: boolean) {\n\t\tthis.$loop = loop;\n\t}\n\n\tpublic get interval(): number {\n\t\treturn this.$interval;\n\t}\n\n\tpublic set interval(interval: number) {\n\t\tthis.$interval = interval;\n\t}\n\n\tpublic get paused(): boolean {\n\t\treturn this.$paused;\n\t}\n\n\tpublic get currentFrame(): number {\n\t\treturn this.$currentFrame;\n\t}\n\n\tpublic get totalFrames(): number {\n\t\treturn this.$frames.length;\n\t}\n\n\tpublic play(): this {\n\t\tthis.off(Event.ADDED_TO_STAGE, this.play);\n\t\treturn this.gotoAndPlay(this.$currentFrame);\n\t}\n\n\tpublic pause(): this {\n\t\tlet ticker = this.ticker;\n\t\tthis.$paused = true;\n\t\tif (ticker) {\n\t\t\tticker.clearTimeout(this.$timer);\n\t\t}\n\t\tthis.off(Event.ADDED_TO_STAGE, this.play);\n\t\treturn this;\n\t}\n\n\tpublic nextFrame(): this {\n\t\treturn this.gotoAndPlay(this.$currentFrame + 1);\n\t}\n\n\tpublic gotoAndPlay(frame: number): this {\n\t\tthis.$paused = false;\n\t\tthis.$gotoFrame(frame);\n\t\tlet loop = this.$loop;\n\t\tlet ticker = this.ticker;\n\t\tlet frames = this.$frames;\n\t\tlet totalFrames = frames.length;\n\t\tlet frameData = frames[this.$currentFrame];\n\t\tif (!frameData) {\n\t\t\treturn;\n\t\t}\n\t\tif (ticker) {\n\t\t\tticker.clearTimeout(this.$timer);\n\t\t\tif (frame < totalFrames - 1 || loop) {\n\t\t\t\tthis.$timer = ticker.setTimeout(this.$boundNextFrame, frameData.interval || this.$interval);\n\t\t\t}\n\t\t} else {\n\t\t\tthis.on(Event.ADDED_TO_STAGE, this.play);\n\t\t}\n\t\treturn this;\n\t}\n\n\tpublic gotoAndStop(frame: number): this {\n\t\tthis.$paused = true;\n\t\tthis.$gotoFrame(frame);\n\t\treturn this;\n\t}\n\n\tprotected $gotoFrame(frame: number): void {\n\t\tlet totalFrames = this.$frames.length;\n\t\tif (frame < 0 || frame >= totalFrames) {\n\t\t\tframe = (frame + totalFrames) % totalFrames;\n\t\t}\n\t\tif (frame < 0) {\n\t\t\tframe = 0;\n\t\t}\n\t\tlet frameData = this.$frames[frame];\n\t\tif (!frameData) {\n\t\t\treturn;\n\t\t}\n\t\tthis.$currentFrame = frame;\n\t\tthis.clipRect = frameData.clip;\n\t\tif (this.stage && frameData.callback) {\n\t\t\tframeData.callback.call(this);\n\t\t}\n\t}\n\n}\n\nexport interface MovieClipFrame {\n\tclip: Rectangle,\n\tinterval?: number,\n\tcallback?: Function\n}\n","import {Event} from '../event/Event';\nimport {EventEmitter} from '../event/EventEmitter';\n\nexport class Request extends EventEmitter {\n\n\tprotected $xhr: XMLHttpRequest = new XMLHttpRequest();\n\n\tpublic constructor(options: RequestOption);\n\tpublic constructor(url: string, options?: RequestOption);\n\tpublic constructor(url?: string | RequestOption, options?: RequestOption) {\n\t\tsuper();\n\t\tlet method;\n\t\tlet headers;\n\t\tlet data;\n\t\tlet responseType;\n\t\tlet xhr = this.$xhr;\n\t\tif (url instanceof Object) {\n\t\t\toptions = url;\n\t\t\turl = options.url;\n\t\t}\n\t\tif (options) {\n\t\t\turl = options.url || url;\n\t\t\tmethod = options.method || 'get';\n\t\t\theaders = options.headers;\n\t\t\tdata = options.data;\n\t\t\tresponseType = options.responseType;\n\t\t}\n\t\tif (data instanceof Object) {\n\t\t\tlet contentType = Request.$getContentType(headers);\n\t\t\tif (method.toLowerCase() === 'get') {\n\t\t\t\tlet qs = Request.$getQueryString(data);\n\t\t\t\turl += url.indexOf('?') < 0 ? '?' + qs : '&' + qs;\n\t\t\t} else if (contentType === 'application/x-www-form-urlencoded') {\n\t\t\t\tdata = Request.$getQueryString(data);\n\t\t\t} else if (contentType === 'application/json') {\n\t\t\t\tdata = JSON.stringify(data);\n\t\t\t}\n\t\t}\n\t\txhr.open(method || 'get', url);\n\t\txhr.responseType = responseType;\n\t\tif (headers) {\n\t\t\tObject.keys(headers).forEach(key => {\n\t\t\t\txhr.setRequestHeader(key, headers[key]);\n\t\t\t});\n\t\t}\n\t\txhr.addEventListener('abort', this.$onAbort.bind(this));\n\t\txhr.addEventListener('progress', this.$onProgress.bind(this));\n\t\txhr.addEventListener('readystatechange', this.$onReadyStateChange.bind(this));\n\t\txhr.send(data);\n\t}\n\n\tpublic get status(): number {\n\t\treturn this.$xhr.status;\n\t}\n\n\tpublic get response(): any {\n\t\treturn this.$xhr.response;\n\t}\n\n\tpublic get responseHeaders(): Object {\n\t\tlet headers = {};\n\t\tlet str = this.$xhr.getAllResponseHeaders();\n\t\tlet arr = str.split('\\n');\n\t\tfor (let header of arr) {\n\t\t\tlet index = header.indexOf(':');\n\t\t\tlet key = header.slice(0, index).trim();\n\t\t\tlet value = header.slice(index + 1).trim();\n\t\t\tif (headers[key]) {\n\t\t\t\tif (!Array.isArray(headers[key])) {\n\t\t\t\t\theaders[key] = [headers[key]];\n\t\t\t\t}\n\t\t\t\theaders[key].push(value);\n\t\t\t} else if (key) {\n\t\t\t\theaders[key] = value;\n\t\t\t}\n\t\t}\n\t\treturn headers;\n\t}\n\n\tpublic abort(): void {\n\t\tthis.$xhr.abort();\n\t}\n\n\tprotected $onAbort(): void {\n\t\tthis.emit(Event.ABORT);\n\t}\n\n\tprotected $onProgress(e: ProgressEvent): void {\n\t\tif (e.lengthComputable) {\n\t\t\tlet event = Event.create(Event.PROGRESS, e.loaded / e.total);\n\t\t\tthis.emit(event);\n\t\t\tevent.release();\n\t\t}\n\t}\n\n\tprotected $onReadyStateChange(e: Event): void {\n\t\tlet xhr = this.$xhr;\n\t\tif (xhr.readyState === 4) {\n\t\t\tif (xhr.status >= 400 || xhr.status === 0) {\n\t\t\t\tthis.emit(Event.ERROR, e);\n\t\t\t} else {\n\t\t\t\tlet event = Event.create(Event.LOAD, xhr.response);\n\t\t\t\tthis.emit(event);\n\t\t\t\tevent.release();\n\t\t\t}\n\t\t\tthis.emit(Event.COMPLETE);\n\t\t}\n\t}\n\n\tprotected static $getContentType(headers: Object): string {\n\t\tfor (let key in headers) {\n\t\t\tif (key.toLowerCase() === 'content-type') {\n\t\t\t\treturn headers[key].toLowerCase();\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tprotected static $getQueryString(data: Object): string {\n\t\treturn Object.keys(data).map(key => key + '=' + data[key]).join('&');\n\t}\n\n}\n\nexport interface RequestOption {\n\turl?: string,\n\tmethod?: string,\n\theaders?: object,\n\tresponseType?: XMLHttpRequestResponseType,\n\tdata?: any\n}\n\n","import {Stage} from '../display/Stage';\nimport {Event} from '../event/Event';\nimport {EventEmitter} from '../event/EventEmitter';\n\nexport class Media extends EventEmitter {\n\n\tprotected readonly $element: HTMLImageElement | HTMLAudioElement;\n\n\tprotected $loaded: boolean = false;\n\tprotected $errored: boolean = false;\n\tprotected readonly $stage: Stage;\n\tprotected readonly $boundOnLoad: () => void;\n\tprotected readonly $boundOnError: (e: ErrorEvent) => void;\n\n\tprotected constructor(stage: Stage) {\n\t\tsuper();\n\t\tthis.$stage = stage;\n\t\tthis.$boundOnLoad = this.$onLoad.bind(this);\n\t\tthis.$boundOnError = this.$onError.bind(this);\n\t}\n\n\tpublic get element(): HTMLImageElement | HTMLAudioElement {\n\t\treturn this.$element;\n\t}\n\n\tpublic get url(): string {\n\t\treturn this.$element.src || '';\n\t}\n\n\tpublic set url(url: string) {\n\t\tthis.$loaded = false;\n\t\tthis.$errored = false;\n\t\tthis.$element.src = url;\n\t}\n\n\tpublic on(type: string, listener: (...args: any[]) => void): this {\n\t\tsuper.on(type, listener);\n\t\tif (type === Event.LOAD && this.$loaded) {\n\t\t\tlet event = Event.create(type);\n\t\t\tlistener.call(this, event);\n\t\t\tevent.release();\n\t\t} else if (type === Event.ERROR && this.$errored) {\n\t\t\tlet event = Event.create(type);\n\t\t\tlistener.call(this, event);\n\t\t\tevent.release();\n\t\t}\n\t\treturn this;\n\t}\n\n\tprotected $onLoad(): void {\n\t\tthis.$loaded = true;\n\t\tthis.emit(Event.LOAD);\n\t\tthis.$element.removeEventListener(Event.LOAD, this.$boundOnLoad);\n\t}\n\n\tprotected $onError(): void {\n\t\tthis.$errored = true;\n\t\tthis.emit(Event.ERROR);\n\t\tthis.$element.removeEventListener(Event.ERROR, this.$boundOnError);\n\t}\n\n}\n","import {Media} from './Media';\nimport {Event} from '../event/Event';\nimport {Stage} from '../display/Stage';\n\nexport class Sound extends Media {\n\n\tprotected $loops: number = 1;\n\tprotected $startTime: number = 0;\n\tprotected $paused: boolean = true;\n\tprotected readonly $element: HTMLAudioElement;\n\tprotected readonly $boundOnTouch: () => void;\n\n\tpublic constructor(stage: Stage, url?: string) {\n\t\tsuper(stage);\n\t\tlet audio = document.createElement('audio');\n\t\taudio.crossOrigin = '*';\n\t\taudio.addEventListener('canplaythrough', this.$boundOnLoad);\n\t\taudio.addEventListener('error', this.$boundOnError);\n\t\taudio.addEventListener('ended', this.$onEnded.bind(this));\n\t\tthis.$element = audio;\n\t\tthis.$boundOnTouch = this.$onTouch.bind(this);\n\t\tif (url) {\n\t\t\tthis.url = url;\n\t\t}\n\t\tstage.ticker.on(Event.TICKER_PAUSE, this.$onTickerPause.bind(this));\n\t\tstage.ticker.on(Event.TICKER_RESUME, this.$onTickerResume.bind(this));\n\t\tstage.on(Event.REMOVED_FROM_STAGE, this.$onRemovedFromStage.bind(this));\n\t}\n\n\tpublic get element(): HTMLAudioElement {\n\t\treturn this.$element;\n\t}\n\n\tpublic get url(): string {\n\t\treturn this.$element.src;\n\t}\n\n\tpublic set url(url: string) {\n\t\tthis.$paused = true;\n\t\tthis.$element.src = url;\n\t\tthis.$element.load();\n\t\tif (url.indexOf('data:') === 0) {\n\t\t\tthis.$stage.ticker.setTimeout(this.$boundOnLoad);\n\t\t}\n\t}\n\n\tpublic get volume(): number {\n\t\treturn this.$element.volume;\n\t}\n\n\tpublic set volume(volume: number) {\n\t\tthis.$element.volume = volume;\n\t}\n\n\tpublic get paused(): boolean {\n\t\treturn this.$paused;\n\t}\n\n\tpublic play(startTime: number = 0, loops: number = 1): this {\n\t\tthis.$loops = loops;\n\t\tthis.$startTime = startTime;\n\t\tthis.$element.currentTime = startTime;\n\t\tthis.$paused = false;\n\t\tthis.$checkStatus();\n\t\treturn this;\n\t}\n\n\tpublic stop(): this {\n\t\tthis.$paused = true;\n\t\tthis.$element.pause();\n\t\treturn this;\n\t}\n\n\tprotected $checkOnTouch(): void {\n\t\tdocument.addEventListener('click', this.$boundOnTouch);\n\t\tdocument.addEventListener('touchend', this.$boundOnTouch);\n\t}\n\n\tprotected $checkStatus(): void {\n\t\tlet promise = this.$element.play();\n\t\tif (promise) {\n\t\t\tpromise.catch();\n\t\t}\n\t\tif (this.$paused) {\n\t\t\tthis.$element.pause();\n\t\t}\n\t}\n\n\tprotected $onTouch(): void {\n\t\tthis.$checkStatus();\n\t\tdocument.removeEventListener('click', this.$boundOnTouch);\n\t\tdocument.removeEventListener('touchend', this.$boundOnTouch);\n\t}\n\n\tprotected $onEnded(): void {\n\t\tthis.emit(Event.ENDED);\n\t\tif (this.$loops === 1) {\n\t\t\tthis.stop();\n\t\t\tthis.emit(Event.SOUND_COMPLETE);\n\t\t} else if (this.$loops === 0) {\n\t\t\tthis.play(this.$startTime, 0);\n\t\t} else {\n\t\t\tthis.play(this.$startTime, this.$loops - 1)\n\t\t}\n\t}\n\n\tprotected $onTickerPause(): void {\n\t\tif (!this.$paused) {\n\t\t\tthis.$element.pause();\n\t\t}\n\t}\n\n\tprotected $onTickerResume(): void {\n\t\tif (!this.$paused) {\n\t\t\tthis.$checkStatus();\n\t\t}\n\t}\n\n\tprotected $onRemovedFromStage(): void {\n\t\tthis.stop();\n\t\tdocument.removeEventListener('click', this.$boundOnTouch);\n\t\tdocument.removeEventListener('touchend', this.$boundOnTouch);\n\t}\n\n\tprotected $onLoad(): void {\n\t\tsuper.$onLoad();\n\t\tlet promise = this.$element.play();\n\t\tif (promise) {\n\t\t\tpromise\n\t\t\t\t.then(this.$checkStatus.bind(this))\n\t\t\t\t.catch(this.$checkOnTouch.bind(this));\n\t\t} else {\n\t\t\tthis.$checkOnTouch();\n\t\t}\n\t}\n\n}\n","import {Media} from './Media';\nimport {Stage} from '../display/Stage';\n\nexport class Texture extends Media {\n\n\tpublic static defaultPixelRatio: number = 1;\n\n\tpublic pixelRatio: number = Texture.defaultPixelRatio;\n\n\tprotected readonly $element: HTMLImageElement;\n\n\tpublic constructor(stage: Stage, url?: string) {\n\t\tsuper(stage);\n\t\tlet image = document.createElement('img');\n\t\timage.crossOrigin = '*';\n\t\timage.addEventListener('load', this.$boundOnLoad);\n\t\timage.addEventListener('error', this.$boundOnError);\n\t\tthis.$element = image;\n\t\tif (url) {\n\t\t\tthis.url = url;\n\t\t}\n\t}\n\n\tpublic get element(): HTMLImageElement {\n\t\treturn this.$element;\n\t}\n\n\tpublic get width(): number {\n\t\treturn this.$element.width / this.pixelRatio;\n\t}\n\n\tpublic get height(): number {\n\t\treturn this.$element.height / this.pixelRatio;\n\t}\n\n}\n","import {Request} from './Request';\nimport {Media} from '../media/Media';\nimport {Sound} from '../media/Sound';\nimport {Texture} from '../media/Texture';\nimport {Stage} from '../display/Stage';\nimport {Event} from '../event/Event';\nimport {EventEmitter} from '../event/EventEmitter';\n\nexport class ResourceManager extends EventEmitter {\n\n\tpublic static readonly TYPE_TEXT: string = 'text';\n\tpublic static readonly TYPE_JSON: string = 'json';\n\tpublic static readonly TYPE_BINARY: string = 'binary';\n\tpublic static readonly TYPE_TEXTURE: string = 'texture';\n\tpublic static readonly TYPE_SOUND: string = 'sound';\n\n\tpublic threads: number;\n\tpublic timeout: number;\n\tpublic retryTimes: number;\n\n\tprotected $errorCount: number = 0;\n\tprotected $loadedCount: number = 0;\n\tprotected $loadingCount: number = 0;\n\tprotected $list: Array<ResourceInfo>;\n\tprotected readonly $total: number;\n\tprotected readonly $stage: Stage;\n\tprotected readonly $resources: Object;\n\n\tpublic constructor(stage: Stage, list: Array<ResourceInfo>, options?: ResourceManagerOption) {\n\t\tsuper();\n\t\tthis.$stage = stage;\n\t\tthis.threads = options && options.threads || 2;\n\t\tthis.timeout = options && options.timeout || 10000;\n\t\tthis.retryTimes = options && options.retryTimes || 3;\n\t\tthis.$list = list.concat();\n\t\tthis.$total = list.length;\n\t\tthis.$resources = {};\n\t\tthis.$checkPendingTasks();\n\t}\n\n\tpublic get total(): number {\n\t\treturn this.$total;\n\t}\n\n\tpublic get errorCount(): number {\n\t\treturn this.$errorCount;\n\t}\n\n\tpublic get loadedCount(): number {\n\t\treturn this.$loadedCount;\n\t}\n\n\tprotected $checkPendingTasks(): void {\n\t\tif (this.$loadingCount < this.threads && this.$list.length > 0) {\n\t\t\t++this.$loadingCount;\n\t\t\tthis.$load(this.$list.shift(), 1);\n\t\t}\n\t}\n\n\tprotected $load(info: ResourceInfo, attempts: number): void {\n\t\tlet timer;\n\t\tlet resource;\n\t\tlet name = info.name;\n\t\tlet type = info.type;\n\t\tlet url = info.url;\n\t\tlet total = this.$total;\n\t\tlet stage = this.$stage;\n\t\tlet ticker = stage.ticker;\n\t\tlet resources = this.$resources;\n\t\tlet retryTimes = this.retryTimes;\n\t\tlet successCallback = () => {\n\t\t\tlet errorCount = this.$errorCount;\n\t\t\tlet loadedCount = ++this.$loadedCount;\n\t\t\t--this.$loadingCount;\n\t\t\tticker.clearTimeout(timer);\n\t\t\tif (resource instanceof Request) {\n\t\t\t\tresources[name] = resource.response;\n\t\t\t} else if (resource instanceof Media) {\n\t\t\t\tresources[name] = resource;\n\t\t\t}\n\t\t\tresource.off(Event.LOAD, successCallback);\n\t\t\tresource.off(Event.ERROR, errorCallback);\n\t\t\tlet event = Event.create(Event.PROGRESS, (loadedCount + errorCount) / total);\n\t\t\tthis.emit(event);\n\t\t\tevent.release();\n\t\t\tif (loadedCount + errorCount === total) {\n\t\t\t\tthis.emit(Event.COMPLETE);\n\t\t\t} else {\n\t\t\t\tthis.$checkPendingTasks();\n\t\t\t}\n\t\t};\n\t\tlet errorCallback = () => {\n\t\t\tif (attempts < retryTimes) {\n\t\t\t\tthis.$load(info, attempts + 1);\n\t\t\t} else {\n\t\t\t\t--this.$loadingCount;\n\t\t\t\tlet loadedCount = this.$loadedCount;\n\t\t\t\tlet errorCount = ++this.$errorCount;\n\t\t\t\tif (resource instanceof Request) {\n\t\t\t\t\tresources[name] = resource.response;\n\t\t\t\t} else if (resource instanceof Media) {\n\t\t\t\t\tresources[name] = resource;\n\t\t\t\t}\n\t\t\t\tthis.emit(Event.PROGRESS, (loadedCount + errorCount) / total);\n\t\t\t\tif (loadedCount + errorCount === total) {\n\t\t\t\t\tthis.emit(Event.COMPLETE);\n\t\t\t\t} else {\n\t\t\t\t\tthis.$checkPendingTasks();\n\t\t\t\t}\n\t\t\t}\n\t\t\tticker.clearTimeout(timer);\n\t\t\tresource.off(Event.LOAD, successCallback);\n\t\t\tresource.off(Event.ERROR, errorCallback);\n\t\t};\n\t\tif (type === ResourceManager.TYPE_TEXT) {\n\t\t\tresource = new Request(url, {responseType: 'text'});\n\t\t\tresource.on(Event.LOAD, successCallback);\n\t\t\tresource.on(Event.ERROR, errorCallback);\n\t\t} else if (type === ResourceManager.TYPE_JSON) {\n\t\t\tresource = new Request(url, {responseType: 'json'});\n\t\t\tresource.on(Event.LOAD, successCallback);\n\t\t\tresource.on(Event.ERROR, errorCallback);\n\t\t} else if (type === ResourceManager.TYPE_BINARY) {\n\t\t\tresource = new Request(url, {responseType: 'arraybuffer'});\n\t\t\tresource.on(Event.LOAD, successCallback);\n\t\t\tresource.on(Event.ERROR, errorCallback);\n\t\t} else if (type === ResourceManager.TYPE_TEXTURE) {\n\t\t\tresource = new Texture(stage, url);\n\t\t\tresource.on(Event.LOAD, successCallback);\n\t\t\tresource.on(Event.ERROR, errorCallback);\n\t\t} else if (type === ResourceManager.TYPE_SOUND) {\n\t\t\tresource = new Sound(stage, url);\n\t\t\tresource.on(Event.LOAD, successCallback);\n\t\t\tresource.on(Event.ERROR, errorCallback);\n\t\t} else {\n\t\t\tthrow new Error('Unsupported resource type: ' + type);\n\t\t}\n\t\ttimer = ticker.setTimeout(errorCallback, this.timeout);\n\t}\n\n\tpublic has(name: string): boolean {\n\t\treturn !!this.$resources[name];\n\t}\n\n\tpublic get<Resource>(name: string): Resource {\n\t\treturn this.$resources[name];\n\t}\n\n}\n\nexport interface ResourceInfo {\n\tname: string,\n\ttype: string,\n\turl: string\n}\n\nexport interface ResourceManagerOption {\n\tthreads?: number,\n\ttimeout?: number,\n\tretryTimes?: number\n}\n","import {Layer} from './Layer';\nimport {Ticker} from '../system/Ticker';\nimport {Vector} from '../geom/Vector';\nimport {Rectangle} from '../geom/Rectangle';\nimport {Event} from '../event/Event';\nimport {TouchEvent} from '../event/TouchEvent';\nimport {ResourceManager, ResourceInfo, ResourceManagerOption} from '../net/ResourceManager';\n\nexport class Stage extends Layer {\n\n\tpublic static readonly SHOW_ALL: string = 'showAll';\n\tpublic static readonly EXACT_FIT: string = 'exactFit';\n\tpublic static readonly NO_SCALE: string = 'noScale';\n\tpublic static readonly NO_BORDER: string = 'noBorder';\n\tpublic static readonly FIXED_WIDE: string = 'fixedWide';\n\tpublic static readonly FIXED_NARROW: string = 'fixedNarrow';\n\tpublic static readonly FIXED_WIDTH: string = 'fixedWidth';\n\tpublic static readonly FIXED_HEIGHT: string = 'fixedHeight';\n\n\tprotected $drawCalls: number = 0;\n\tprotected $activated: boolean = false;\n\tprotected $scaleMode: string = Stage.SHOW_ALL;\n\tprotected $viewportWidth: number = 0;\n\tprotected $viewportHeight: number = 0;\n\tprotected $viewportBackground: string = null;\n\tprotected readonly $ticker: Ticker;\n\tprotected readonly $elementEvents: ElementEvent[];\n\tprotected readonly $viewportCanvas: HTMLCanvasElement;\n\tprotected readonly $viewportContext: CanvasRenderingContext2D;\n\tprotected readonly $renderBounds: Rectangle = Rectangle.create();\n\tprotected readonly $boundResizeViewportCanvas: () => void;\n\n\tpublic constructor(canvas?: HTMLCanvasElement) {\n\t\tsuper();\n\t\tthis.$ticker = new Ticker(this);\n\t\tthis.$elementEvents = [];\n\t\tthis.$viewportCanvas = canvas || document.createElement('canvas');\n\t\tthis.$viewportContext = this.$viewportCanvas.getContext('2d');\n\t\tthis.$boundResizeViewportCanvas = this.$resizeViewportCanvas.bind(this);\n\t\tthis.$resizeViewportCanvas();\n\t\tthis.$initEvents();\n\t\tthis.width = 320;\n\t\tthis.height = 568;\n\n\t\tif (!canvas) {\n\t\t\tthis.$viewportCanvas.style.top = '0';\n\t\t\tthis.$viewportCanvas.style.left = '0';\n\t\t\tthis.$viewportCanvas.style.position = 'fixed';\n\t\t\tdocument.body.appendChild(this.$viewportCanvas);\n\t\t}\n\t}\n\n\tpublic get x(): number {\n\t\treturn 0;\n\t}\n\n\tpublic set x(x: number) {\n\t\tthis.$x = 0;\n\t}\n\n\tpublic get y(): number {\n\t\treturn 0;\n\t}\n\n\tpublic set y(y: number) {\n\t\tthis.$y = 0;\n\t}\n\n\tpublic get ticker(): Ticker {\n\t\treturn this.$ticker;\n\t}\n\n\tpublic get fps(): number {\n\t\treturn this.$ticker.fps;\n\t}\n\n\tpublic get drawCalls(): number {\n\t\treturn this.$drawCalls;\n\t}\n\n\tpublic get activated(): boolean {\n\t\treturn this.$activated;\n\t}\n\n\tpublic get scaleMode(): string {\n\t\treturn this.$scaleMode;\n\t}\n\n\tpublic set scaleMode(scaleMode: string) {\n\t\tif (this.scaleMode !== scaleMode) {\n\t\t\tthis.$scaleMode = scaleMode;\n\t\t\tthis.$resizeCanvas();\n\t\t}\n\t}\n\n\tpublic get viewportCanvas(): HTMLCanvasElement {\n\t\treturn this.$viewportCanvas;\n\t}\n\n\tpublic get viewportWidth(): number {\n\t\treturn this.$viewportWidth ? this.$viewportWidth : this.$viewportCanvas.width / Layer.pixelRatio;\n\t}\n\n\tpublic set viewportWidth(width: number) {\n\t\tif (this.$viewportWidth !== width) {\n\t\t\tthis.$viewportWidth = width;\n\t\t\tthis.$resizeViewportCanvas();\n\t\t}\n\t}\n\n\tpublic get viewportHeight(): number {\n\t\treturn this.$viewportHeight ? this.$viewportHeight : this.$viewportCanvas.height / Layer.pixelRatio;\n\t}\n\n\tpublic set viewportHeight(height: number) {\n\t\tif (this.$viewportHeight !== height) {\n\t\t\tthis.$viewportHeight = height;\n\t\t\tthis.$resizeViewportCanvas();\n\t\t}\n\t}\n\n\tpublic get viewportBackground(): string {\n\t\treturn this.$viewportBackground;\n\t}\n\n\tpublic set viewportBackground(viewportBackground: string) {\n\t\tthis.$viewportBackground = viewportBackground;\n\t\tthis.$viewportCanvas.style.background = viewportBackground;\n\t}\n\n\tpublic createResourceManager(list: Array<ResourceInfo>, options?: ResourceManagerOption): ResourceManager {\n\t\treturn new ResourceManager(this, list, options);\n\t}\n\n\tpublic removeSelf(): this {\n\t\tlet canvas = this.$viewportCanvas;\n\t\tif (canvas.parentElement) {\n\t\t\tcanvas.parentElement.removeChild(canvas);\n\t\t}\n\t\tif (this.$activated) {\n\t\t\tthis.$activated = false;\n\t\t\tthis.emit(Event.DEACTIVATE);\n\t\t}\n\t\tif (this.$stage) {\n\t\t\tthis.$emitRemovedFromStage();\n\t\t}\n\t\tthis.$removeElementEvents();\n\t\treturn this;\n\t}\n\n\tprotected $initEvents(): void {\n\t\tlet prefix;\n\t\tlet hiddenKey;\n\t\tlet resizeTimer;\n\t\tlet ticker = this.$ticker;\n\t\tlet prefixes = ['', 'o', 'ms', 'moz', 'webkit'];\n\t\tfor (prefix of prefixes) {\n\t\t\thiddenKey = prefix ? prefix + 'Hidden' : 'hidden';\n\t\t\tif (document[hiddenKey] !== undefined) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tthis.$addTouchEventListeners();\n\t\tthis.$addElementEvent(window, 'orientationchange', () => {\n\t\t\tticker.clearTimeout(resizeTimer);\n\t\t\tresizeTimer = ticker.setTimeout(this.$boundResizeViewportCanvas, 100);\n\t\t});\n\t\tthis.$addElementEvent(window, prefix + 'visibilitychange', () => {\n\t\t\tlet hidden = document[hiddenKey];\n\t\t\tthis.$activated = !hidden;\n\t\t\tthis.emit(hidden ? Event.DEACTIVATE : Event.ACTIVATE);\n\t\t});\n\t\tthis.on(Event.ENTER_FRAME, this.$render);\n\t\tsetTimeout(() => {\n\t\t\tif (!document[hiddenKey]) {\n\t\t\t\tthis.$activated = true;\n\t\t\t\tthis.emit(Event.ACTIVATE);\n\t\t\t}\n\t\t\tthis.$emitAddedToStage(this);\n\t\t});\n\t}\n\n\tprotected $addElementEvent(target: EventTarget, type: string, listener: (event) => void, options?: boolean | AddEventListenerOptions): void {\n\t\ttarget.addEventListener(type, listener, options);\n\t\tthis.$elementEvents.push({target, type, listener});\n\t}\n\n\tprotected $removeElementEvents(): void {\n\t\tlet listeners = this.$elementEvents;\n\t\tfor (let {target, type, listener} of listeners) {\n\t\t\ttarget.removeEventListener(type, listener);\n\t\t}\n\t\tlisteners.length = 0;\n\t}\n\n\tprotected $addTouchEventListeners(): void {\n\t\tif (document.ontouchstart !== undefined) {\n\t\t\tthis.$addElementEvent(document, 'touchstart', event => {\n\t\t\t\tthis.$dispatchTouches(TouchEvent.TOUCH_START, event);\n\t\t\t});\n\t\t\tthis.$addElementEvent(document, 'touchmove', event => {\n\t\t\t\tthis.$dispatchTouches(TouchEvent.TOUCH_MOVE, event);\n\t\t\t\tevent.preventDefault();\n\t\t\t}, {passive: false});\n\t\t\tthis.$addElementEvent(document, 'touchend', event => {\n\t\t\t\tthis.$dispatchTouches(TouchEvent.TOUCH_END, event);\n\t\t\t\tthis.$dispatchTouches(TouchEvent.TOUCH_TAP, event);\n\t\t\t});\n\t\t\tthis.$addElementEvent(document, 'touchcancel', event => {\n\t\t\t\tthis.$dispatchTouches(TouchEvent.TOUCH_CANCEL, event);\n\t\t\t});\n\t\t} else {\n\t\t\tlet touching = false;\n\t\t\tthis.$addElementEvent(window, 'mousedown', event => {\n\t\t\t\tthis.$dispatchTouchEvent(TouchEvent.TOUCH_START, event.pageX, event.pageY, 0);\n\t\t\t\ttouching = true;\n\t\t\t});\n\t\t\tthis.$addElementEvent(window, 'mousemove', event => {\n\t\t\t\tif (touching) {\n\t\t\t\t\tthis.$dispatchTouchEvent(TouchEvent.TOUCH_MOVE, event.pageX, event.pageY, 0);\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.$addElementEvent(window, 'mouseup', event => {\n\t\t\t\tthis.$dispatchTouchEvent(TouchEvent.TOUCH_END, event.pageX, event.pageY, 0);\n\t\t\t\ttouching = false;\n\t\t\t});\n\t\t\tthis.$addElementEvent(window, 'click', event => {\n\t\t\t\tthis.$dispatchTouchEvent(TouchEvent.TOUCH_TAP, event.pageX, event.pageY, 0);\n\t\t\t});\n\t\t\tthis.$addElementEvent(window, 'blur', () => {\n\t\t\t\tthis.$dispatchTouchEvent(TouchEvent.TOUCH_CANCEL, 0, 0, 0);\n\t\t\t\ttouching = false;\n\t\t\t});\n\t\t}\n\t}\n\n\tprotected $dispatchTouches(type: string, event: any): void {\n\t\tlet touches = event['changedTouches'];\n\t\tfor (let i = 0, l = touches.length; i < l; ++i) {\n\t\t\tlet touch = touches[i];\n\t\t\tthis.$dispatchTouchEvent(type, touch.pageX, touch.pageY, touch.identifier);\n\t\t}\n\t}\n\n\tprotected $dispatchTouchEvent(type: string, pageX: number, pageY: number, identifier: number): void {\n\t\tif (this.$ticker.paused || !this.$visible || !this.touchable) {\n\t\t\treturn;\n\t\t}\n\t\tlet event = TouchEvent.create(type);\n\t\tlet scrollX = window.scrollX || 0;\n\t\tlet scrollY = window.scrollY || 0;\n\t\tlet width = this.$canvas.width;\n\t\tlet height = this.$canvas.height;\n\t\tlet bounds = this.$renderBounds;\n\t\tlet pixelRatio = Layer.pixelRatio;\n\t\tlet viewportBounds = this.$viewportCanvas.getBoundingClientRect();\n\t\tlet x = (pageX - scrollX - viewportBounds.left - bounds.x / pixelRatio) * width / bounds.width - this.$anchorX;\n\t\tlet y = (pageY - scrollY - viewportBounds.top - bounds.y / pixelRatio) * height / bounds.height - this.$anchorY;\n\t\tlet matrix = this.$getTransform();\n\t\tlet localPos = Vector.create(x, y).transform(matrix.invert()).subtract(this.$anchorX, this.$anchorY);\n\t\tlet inside = this.$localHitTest(localPos);\n\t\tif (inside || type !== TouchEvent.TOUCH_START) {\n\t\t\tevent.localX = localPos.x;\n\t\t\tevent.localY = localPos.y;\n\t\t\tevent.targetX = event.stageX = x;\n\t\t\tevent.targetY = event.stageY = y;\n\t\t\tevent.identifier = identifier;\n\t\t\tthis.$emitTouchEvent(event, inside);\n\t\t}\n\t\tevent.release();\n\t\tmatrix.release();\n\t\tlocalPos.release();\n\t}\n\n\tprotected $calculateRenderBounds(): void {\n\t\tlet x = 0;\n\t\tlet y = 0;\n\t\tlet canvas = this.$canvas;\n\t\tlet width = canvas.width;\n\t\tlet height = canvas.height;\n\t\tlet scaleMode = this.$scaleMode;\n\t\tlet bounds = this.$renderBounds;\n\t\tlet aspectRatio = width / height;\n\t\tlet viewportCanvas = this.$viewportCanvas;\n\t\tlet viewportWidth = viewportCanvas.width;\n\t\tlet viewportHeight = viewportCanvas.height;\n\t\tlet viewportAspectRatio = viewportWidth / viewportHeight;\n\t\tif (scaleMode === Stage.SHOW_ALL) {\n\t\t\tif (aspectRatio > viewportAspectRatio) {\n\t\t\t\twidth = viewportWidth;\n\t\t\t\theight = width / aspectRatio;\n\t\t\t} else {\n\t\t\t\theight = viewportHeight;\n\t\t\t\twidth = height * aspectRatio;\n\t\t\t}\n\t\t} else if (scaleMode === Stage.EXACT_FIT) {\n\t\t\twidth = viewportWidth;\n\t\t\theight = viewportHeight;\n\t\t} else if (scaleMode === Stage.NO_BORDER) {\n\t\t\tif (aspectRatio < viewportAspectRatio) {\n\t\t\t\twidth = viewportWidth;\n\t\t\t\theight = width / aspectRatio;\n\t\t\t} else {\n\t\t\t\theight = viewportHeight;\n\t\t\t\twidth = height * aspectRatio;\n\t\t\t}\n\t\t\tx = (viewportWidth - width) / 2;\n\t\t\ty = (viewportHeight - height) / 2;\n\t\t} else if (scaleMode === Stage.FIXED_WIDTH) {\n\t\t\twidth = viewportWidth;\n\t\t\theight = width / aspectRatio;\n\t\t} else if (scaleMode === Stage.FIXED_HEIGHT) {\n\t\t\theight = viewportHeight;\n\t\t\twidth = height * aspectRatio;\n\t\t} else if (scaleMode === Stage.FIXED_WIDE) {\n\t\t\tif (viewportWidth > viewportHeight) {\n\t\t\t\twidth = viewportWidth;\n\t\t\t\theight = width / aspectRatio;\n\t\t\t} else {\n\t\t\t\theight = viewportHeight;\n\t\t\t\twidth = height * aspectRatio;\n\t\t\t}\n\t\t} else if (scaleMode === Stage.FIXED_NARROW) {\n\t\t\tif (viewportWidth < viewportHeight) {\n\t\t\t\twidth = viewportWidth;\n\t\t\t\theight = width / aspectRatio;\n\t\t\t} else {\n\t\t\t\theight = viewportHeight;\n\t\t\t\twidth = height * aspectRatio;\n\t\t\t}\n\t\t}\n\t\tif (width < viewportWidth) {\n\t\t\tx = (viewportWidth - width) / 2;\n\t\t}\n\t\tif (height < viewportHeight) {\n\t\t\ty = (viewportHeight - height) / 2;\n\t\t}\n\t\tbounds.x = x;\n\t\tbounds.y = y;\n\t\tbounds.width = width;\n\t\tbounds.height = height;\n\t}\n\n\tprotected $resizeCanvas(): void {\n\t\tsuper.$resizeCanvas();\n\t\tthis.$calculateRenderBounds();\n\t}\n\n\tprotected $resizeViewportCanvas(): void {\n\t\tlet canvas = this.$viewportCanvas;\n\t\tlet pixelRatio = Layer.pixelRatio;\n\t\tlet viewportWidth = this.$viewportWidth || window.innerWidth;\n\t\tlet viewportHeight = this.$viewportHeight || window.innerHeight;\n\t\tlet canvasWidth = viewportWidth * pixelRatio;\n\t\tlet canvasHeight = viewportHeight * pixelRatio;\n\t\tif (canvas.width !== canvasWidth || canvas.height !== canvasHeight) {\n\t\t\tcanvas.width = canvasWidth;\n\t\t\tcanvas.height = canvasHeight;\n\t\t\tcanvas.style.width = viewportWidth + 'px';\n\t\t\tcanvas.style.height = viewportHeight + 'px';\n\t\t\tthis.$calculateRenderBounds();\n\t\t\tthis.$markDirty();\n\t\t\tthis.emit(Event.VIEWPORT_RESIZE);\n\t\t}\n\t}\n\n\tprotected $render(): number {\n\t\tif (!this.$dirty) {\n\t\t\tthis.$drawCalls = 0;\n\t\t\treturn 0;\n\t\t}\n\t\tlet drawCalls = super.$render();\n\t\tlet canvas = this.$canvas;\n\t\tlet ctx = this.$viewportContext;\n\t\tlet bounds = this.$renderBounds;\n\t\tlet viewportCanvas = this.$viewportCanvas;\n\t\tlet viewportWidth = viewportCanvas.width;\n\t\tlet viewportHeight = viewportCanvas.height;\n\t\tctx.clearRect(0, 0, viewportWidth, viewportHeight);\n\t\tctx.drawImage(canvas, (bounds.x + 0.5) | 0, (bounds.y + 0.5) | 0, (bounds.width + 0.5) | 0, (bounds.height + 0.5) | 0);\n\t\tthis.$drawCalls = ++drawCalls;\n\t\treturn drawCalls;\n\t}\n\n}\n\ninterface ElementEvent {\n\ttarget: EventTarget,\n\ttype: string,\n\tlistener: (event) => void\n}\n","import * as Ticker from './system/Ticker';\nimport * as Layer from './display/Layer';\nimport * as Scroller from './display/Scroller';\nimport * as Image from './display/Image';\nimport * as Text from './display/Text';\nimport * as Input from './display/Input';\nimport * as MovieClip from './display/MovieClip';\nimport * as Stage from './display/Stage';\nimport * as Event from './event/Event';\nimport * as TouchEvent from './event/TouchEvent';\nimport * as EventEmitter from './event/EventEmitter';\nimport * as Matrix from './geom/Matrix';\nimport * as Vector from './geom/Vector';\nimport * as Rectangle from './geom/Rectangle';\nimport * as Media from './media/Media';\nimport * as Texture from './media/Texture';\nimport * as Sound from './media/Sound';\nimport * as Ease from './tween/Ease';\nimport * as Tween from './tween/Tween';\nimport * as Request from './net/Request';\nimport * as ResourceManager from './net/ResourceManager';\n\nexport * from './system/Ticker';\nexport * from './display/Layer';\nexport * from './display/Scroller';\nexport * from './display/Image';\nexport * from './display/Text';\nexport * from './display/Input';\nexport * from './display/MovieClip';\nexport * from './display/Stage';\nexport * from './event/Event';\nexport * from './event/TouchEvent';\nexport * from './event/EventEmitter';\nexport * from './geom/Matrix';\nexport * from './geom/Vector';\nexport * from './geom/Rectangle';\nexport * from './media/Media';\nexport * from './media/Texture';\nexport * from './media/Sound';\nexport * from './tween/Ease';\nexport * from './tween/Tween';\nexport * from './net/Request';\nexport * from './net/ResourceManager';\n\nexport default {\n\t...Ticker,\n\t...Layer,\n\t...Scroller,\n\t...Image,\n\t...Text,\n\t...Input,\n\t...MovieClip,\n\t...Stage,\n\t...Event,\n\t...TouchEvent,\n\t...EventEmitter,\n\t...Matrix,\n\t...Vector,\n\t...Rectangle,\n\t...Media,\n\t...Texture,\n\t...Sound,\n\t...Ease,\n\t...Tween,\n\t...Request,\n\t...ResourceManager\n};\n"],"names":["Event","constructor","type","data","this","target","currentTarget","$init","release","recycle","create","pool","$pool","length","pop","e","push","ADDED","REMOVED","ADDED_TO_STAGE","REMOVED_FROM_STAGE","ACTIVATE","DEACTIVATE","ENTER_FRAME","TICK","TICKER_PAUSE","TICKER_RESUME","VIEWPORT_RESIZE","LOAD","ABORT","ERROR","PROGRESS","COMPLETE","ENDED","SOUND_COMPLETE","EventEmitter","$events","$emittingType","$removedListeners","on","listener","listeners","off","index","indexOf","splice","once","that","wrapper","apply","arguments","emit","args","event","hasListeners","removedListeners","hasEventListener","removeAllListeners","Ticker","stage","super","$stage","$fps","$deltaTime","$paused","$shouldResume","$timerIndex","$lastTimestamp","$tickHandle","$timers","$boundTick","$tick","bind","$enterFrameCallbackList","$start","fps","deltaTime","paused","prefixes","prefix","requestKey","cancelKey","cancelRequestKey","window","requestAnimationFrame","cancelAnimationFrame","callback","setTimeout","handle","clearTimeout","resume","pause","activated","handler","timeout","resetTime","setInterval","interval","clearInterval","registerEnterFrameCallback","layer","list","unregisterEnterFrameCallback","now","Date","enterFrameCallbackList","Math","round","$checkTimers","tickEvent","dt","timers","key","timer","Vector","x","y","set","sqrt","angle","atan2","add","subtract","dotProduct","normalize","negate","scale","undefined","rotate","cos","sin","transform","m","a","c","tx","b","d","ty","distance","v","equal","Matrix","identity","invert","n","prepend","a1","b1","c1","d1","tx1","ty1","append","skew","skewX","skewY","tan","translate","Rectangle","width","height","top","bottom","left","right","topLeft","bottomRight","contains","r","TouchEvent","targetX","targetY","localX","localY","stageX","stageY","identifier","cancelBubble","stopPropagation","TOUCH_START","TOUCH_MOVE","TOUCH_END","TOUCH_CANCEL","TOUCH_TAP","Layer","name","tag","touchable","$x","$y","$width","$height","$anchorX","$anchorY","$skewX","$skewY","$scaleX","$scaleY","$rotation","$alpha","$visible","$smoothing","$background","$parent","$children","$dirty","$shouldEmitTap","$touches","$canvas","document","createElement","$context","getContext","$markParentDirty","pixelRatio","$resizeCanvas","anchorX","anchorY","scaleX","scaleY","rotation","alpha","visible","smoothing","background","$markDirty","parent","numChildren","ticker","canvas","addChild","child","addChildAt","children","removeChild","$emitAdded","replaceChild","oldChild","newChild","getChildIndex","removeChildAt","getChildByName","getChildrenByTag","result","getChildAt","hasChild","swapChildren","child1","child2","index1","index2","swapChildrenAt","setChildIndex","oldIndex","i","$emitRemoved","removeChildByName","l","removeChildrenByTag","removeAllChildren","removeSelf","sizeDirty","$resizeParentCanvas","context","bounds","$getContentBounds","imageSmoothingEnabled","$getTransform","degToRad","PI","matrix","$getChildTransform","$getChildBounds","topRight","bottomLeft","minX","min","maxX","max","minY","maxY","childBounds","$emitTouchEvent","inside","touches","localPos","$localHitTest","$emitAddedToStage","$emitRemovedFromStage","vector","$isChildVisible","$drawChild","ctx","drawCalls","$render","globalAlpha","drawImage","save","restore","canvasWidth","canvasHeight","setTransform","clearRect","fillStyle","fillRect","call","devicePixelRatio","Ease","linear","t","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","easeOutSine","easeInOutSine","easeInExpo","pow","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc","easeInElastic","s","p","abs","asin","easeOutElastic","easeInOutElastic","easeInBack","easeOutBack","easeInOutBack","easeInBounce","easeOutBounce","easeInOutBounce","Tween","option","loop","$target","$stopped","$stepIndex","$stepPosition","$steps","$stepProps","$shouldSaveProps","$boundOnEnterFrame","$onEnterFrame","stopped","props","to","duration","ease","wait","play","$tweens","stop","$nextFrame","steps","stepLength","stepIndex","stepPosition","step","$setProps","$easeProps","$saveOriginalProps","stepProps","originalProps","position","originalValue","offsetValue","get","pauseTweens","tweens","tween","resumeTweens","removeTweens","removeAllTweens","Scroller","$scrollTop","$scrollLeft","$scrollWidth","$scrollHeight","$touchingX","$touchingY","$touchingId","$touchingTime","$velocitiesX","$velocitiesY","$inertiaTween","$onTouchStart","$onTouchMove","$onTouchEnd","$onTouchCancel","scrollTop","maxScrollTop","scrollLeft","maxScrollLeft","scrollWidth","scrollHeight","velocitiesX","velocitiesY","offsetX","offsetY","scrollingView","shift","sumVelocityX","sumVelocityY","numVelocities","velocityX","velocityY","absVelocityX","absVelocityY","Image","texture","$texture","$fillMode","SCALE","$clipRect","$scale9Grid","$pattern","$boundOnTextureLoad","$onTextureLoad","$updatePattern","fillMode","clipRect","scale9Grid","createPattern","element","$drawPattern","targetW","targetH","pattern","$drawTexture","sourceX","sourceY","sourceW","sourceH","clipX","clipY","clipWidth","clipHeight","sourceX0","sourceY0","sourceW0","sourceH0","sourceX1","sourceY1","sourceW1","sourceH1","sourceX2","sourceY2","sourceW2","sourceH2","targetX0","targetY0","targetW0","targetH0","targetX1","targetY1","targetW1","targetH1","targetX2","targetY2","targetW2","targetH2","REPEAT","REPEAT_X","REPEAT_Y","Text","text","options","$text","$color","$fontSize","defaultFontSize","$fontStyle","$fontWeight","$textAlign","$verticalAlign","$lineHeight","$strokeSize","$strokeColor","$fontFamily","$multiline","$breakWord","$autoFitSize","$minFontSize","$explicitSize","$lines","color","fontSize","fontStyle","fontWeight","textAlign","verticalAlign","lineHeight","strokeSize","strokeColor","fontFamily","multiline","breakWord","autoFitSize","minFontSize","$updateContext","sizeStr","font","textBaseline","lineWidth","strokeStyle","$divideUnits","units","wordRe","boundaryRe","split","words","unit","test","concat","$divideLines","line","lines","measureText","fillText","strokeText","Input","value","$value","$type","$maxLength","$placeholder","$placeholderColor","$explicitColor","maxLength","placeholder","placeholderColor","$boundFocus","focus","$updateText","$onTouchTap","selectAll","$updateElement","selectionStart","selectionEnd","style","display","$focusedInput","blur","tagName","$getElement","isInput","margin","minHeight","maxHeight","padding","border","resize","outline","boxSizing","wordBreak","boxShadow","$inputElement","$textAreaElement","body","appendChild","addEventListener","keyCode","MovieClip","frames","$loop","$interval","$currentFrame","$frames","$boundNextFrame","nextFrame","currentFrame","totalFrames","gotoAndPlay","$timer","frame","$gotoFrame","frameData","gotoAndStop","clip","Request","url","method","headers","responseType","$xhr","XMLHttpRequest","xhr","Object","contentType","$getContentType","toLowerCase","qs","$getQueryString","JSON","stringify","open","keys","forEach","setRequestHeader","$onAbort","$onProgress","$onReadyStateChange","send","status","response","responseHeaders","arr","getAllResponseHeaders","header","slice","trim","Array","isArray","abort","lengthComputable","loaded","total","readyState","map","join","Media","$loaded","$errored","$boundOnLoad","$onLoad","$boundOnError","$onError","$element","src","removeEventListener","Sound","$loops","$startTime","audio","crossOrigin","$onEnded","$boundOnTouch","$onTouch","$onTickerPause","$onTickerResume","$onRemovedFromStage","load","volume","startTime","loops","currentTime","$checkStatus","$checkOnTouch","promise","catch","then","Texture","defaultPixelRatio","image","ResourceManager","$errorCount","$loadedCount","$loadingCount","threads","retryTimes","$list","$total","$resources","$checkPendingTasks","errorCount","loadedCount","$load","info","attempts","resource","resources","successCallback","errorCallback","TYPE_TEXT","TYPE_JSON","TYPE_BINARY","TYPE_TEXTURE","TYPE_SOUND","Error","has","Stage","$drawCalls","$activated","$scaleMode","SHOW_ALL","$viewportWidth","$viewportHeight","$viewportBackground","$renderBounds","$ticker","$elementEvents","$viewportCanvas","$viewportContext","$boundResizeViewportCanvas","$resizeViewportCanvas","$initEvents","scaleMode","viewportCanvas","viewportWidth","viewportHeight","viewportBackground","createResourceManager","parentElement","$removeElementEvents","hiddenKey","resizeTimer","$addTouchEventListeners","$addElementEvent","hidden","ontouchstart","$dispatchTouches","preventDefault","passive","touching","$dispatchTouchEvent","pageX","pageY","touch","scrollX","scrollY","viewportBounds","getBoundingClientRect","$calculateRenderBounds","aspectRatio","viewportAspectRatio","EXACT_FIT","NO_BORDER","FIXED_WIDTH","FIXED_HEIGHT","FIXED_WIDE","FIXED_NARROW","innerWidth","innerHeight","NO_SCALE"],"mappings":"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"}